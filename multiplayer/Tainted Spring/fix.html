<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Fix Missing Player Info</title>
<link rel="stylesheet" href="../../style.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #e3dba2;
      color: #967e00;
      margin: 20px auto;
      max-width: 1000px;
      text-align: center;
    }
    h2 {
      color: white;
    }
    p {
      margin-top: 0;
      margin-bottom: 20px;
    }
    .column-wrapper {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 20px;
    }
    .player-column {
      flex: 1;
      min-width: 200px;
      background: #303030;
      border: 2px solid #676767;
      border-radius: 8px;
      padding: 15px;
      text-align: left;
	color: #9e9e9f;
    }
    .player-column h3 {
      margin-top: 0;
      margin-bottom: 10px;
      color: #9e9e9f;
    }
    label {
      display: block;
      font-weight: bold;
      margin-top: 10px;
    }
    input, select {
      width: 100%;
      padding: 6px;
      margin-top: 4px;
      box-sizing: border-box;
      border: 2px solid #676767;
      border-radius: 6px;
      background: #676767;
      font-size: 14px;
      color: #9e9e9f;
    }
input::placeholder {
  color: #9d9d9d;
}
    input.missing, select.missing {
      border-color: #9a0000;
    }
    .submitButton {
      text-align: center;
      margin-top: 30px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      border: 2px solid #303030;
      cursor: pointer;
    }
    button:hover {
      background-color:  #9d9d9d;
    }
  </style>
</head>
<body>
<article>
  <h2>Complete Missing Player Information</h2>
  <p>One or more player fields were empty. Please fill them in and continue.</p>
	<hr>
  <div class="column-wrapper" id="fixColumns"></div>
  <div class="submitButton">
    <button onclick="submitFix()">Continue to Index</button>
  </div>
</article>

  <script>
    // 1) Definitions
    const params      = new URLSearchParams(window.location.search);
    const container   = document.getElementById('fixColumns');
    const totalPlayers= 4;
    const fields      = [
      { key:'Name',      label:'Name',                           type:'text'   },
      { key:'HeSheThey', label:'Pronoun (she/he/they/it)',       type:'select', options:['','she','he','they','it'] },
      { key:'Class',     label:'Class',                          type:'select', options:['','fighter','healer','mage'] },
      { key:'Weapon',    label:'Weapon',                         type:'text',  lowercase:true },
      { key:'Damage',    label:'Damage (integer â‰¥ 0)',           type:'number', min:0, step:1 }
    ];

    // 2) Build one column per player
    for (let i = 1; i <= totalPlayers; i++) {
      const col = document.createElement('div');
      col.className = 'player-column';
      col.id        = 'player' + i;

      // heading
      const h3 = document.createElement('h3');
      h3.innerText = 'Player ' + i;
      col.appendChild(h3);

      // each field
      fields.forEach(f => {
        const key    = `Player${i}${f.key}`;
        const value  = params.get(key) || '';
        const missing= value.trim() === '';

        // label
        const lbl = document.createElement('label');
        lbl.htmlFor = key;
        lbl.innerText = f.label;
        col.appendChild(lbl);

        // input or select
        let input;
        if (f.type === 'select') {
          input = document.createElement('select');
		input.required = true;
          f.options.forEach(optVal => {
            const opt = document.createElement('option');
            opt.value   = optVal;
            opt.innerText = optVal || '-- select --';
            if (optVal === value) opt.selected = true;
            input.appendChild(opt);
          });
        } else {
          input = document.createElement('input');
          input.type = f.type;
          if (f.type === 'number') {
            input.min  = f.min;
            input.step = f.step;
          }
          input.value = value;
          input.placeholder = f.key;
          if (f.lowercase) {
            input.oninput = () => input.value = input.value.toLowerCase();
          }
        }
        input.id    = input.name = key;
        if (missing) input.classList.add('missing');

        // remove missing highlight on change
        input.addEventListener('input', () => {
          if (input.value.trim() !== '') {
            input.classList.remove('missing');
          }
        });

        col.appendChild(input);
      });

      container.appendChild(col);
    }

    // 3) Validate and redirect
    function submitFix() {
      const newParams = new URLSearchParams();
      const missing   = [];

      for (let i = 1; i <= totalPlayers; i++) {
        fields.forEach(f => {
          const key = `Player${i}${f.key}`;
          const el  = document.getElementById(key);
          const v   = (el.value || '').trim();
          if (!v) {
            missing.push(`Player ${i} ${f.label}`);
            el.classList.add('missing');
          } else {
            newParams.set(key, v);
          }
        });
      }

      if (missing.length) {
        alert('Please fill in:\n' + missing.join('\n'));
        return;
      }

      
      window.location.href = `index.html?${newParams.toString()}`;
    }
  </script>
</body>
</html>
