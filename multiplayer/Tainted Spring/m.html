<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title id="pageTitle">Multiplayer Prompt</title>
<link rel="stylesheet" href="../../style.css">
  <style>
    .storyButton {
	width: 100%;
	color: white;
    }
    .storyButton:hover {
      background: #ffffff;
    }
    article {
      max-width: 1000px;
    }
button{
	width: 50%;
}
#conditionButtons {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

#conditionButtons button {
  padding: 0.5rem 1rem;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  gap: 1rem;
}

.narrative-box {
  background: #111;
  color: #eee;
  padding: 1rem;
  border-radius: 6px;
  font-family: serif;
  white-space: pre-wrap;
}



    #copyBuffer {
      position: absolute;
      left: -9999px;
    }

    /* HP Tracker as two boxes */
    #hpContainer {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin: 20px auto;
    }
    .hp-box {
      background: #676767;
      border: 2px solid #303030;
      border-radius: 8px;
      padding: 10px;
      width: 48%;
      text-align: right;
    }
    .hp-box h3 {
      color: white;
      margin-bottom: 12px;
	margin-top: 12px;
	text-align: center;
	font-size: 30px;
    }
    .hp-entry {
      display: flex;
      align-items: right;
      justify-content: space-between;
      margin-bottom: 8px;
  gap: 8px;

    }
    .hp-entry span {
      flex: 1;
	width: 100px;    
    }
    .hp-entry input[type="number"] {
      width: 50px;
      margin: 0px;
  	text-align: center;
	background: #a1a1a2;

    }
	.gray{
	margin: 0;
	padding
	background: #303030;
}
.hp-entry {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem 0;
  border-bottom: 1px solid #ccc;
}

.hp-left {
  flex: 1;
  font-weight: bold;
  padding-right: 1rem;
	text-align: left;
}

.hp-right {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.hp-right input[type="number"] {
  width: 4rem;
  text-align: center;
}

.dead-toggle {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  cursor: pointer;
}
.col {
  flex: 1;
width: 33%;
}
.col button{
width: 100%;
}
.continueButtons{
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  justify-content: center;
width: 100%;

}
.continueButtons button{
  flex: 1 1 200px; /* grow, shrink, base width */
  padding: 0.75rem 1rem;
  font-size: 1rem;
  font-weight: bold;
  text-align: center;
  }
.continueButtons a{
	display: inline-block;
	width: 40%;
}
#storyBox{
	background: #676767;
}
#conditionText{
	background: #303030;
}
#narrativeContent{
	background: #676767;
	padding: 10px;
}
button{
color: white;
}
#openNewTab{
width: 100%;
}

  </style>
</head>
<body>
<article>
<div class="container">

<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">
  <div>
  <h2 id="promptTitle">Your Prompt Title Here</h2>
  <p>By Tenshilove</p>
</div>
<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">

</div>

<hr>

  <div id="customDisplay"></div>
  <button class="storyButton" onclick="goToFix()">Fix Parameters</button>
  <button class="storyButton" onclick="goToPage('index')">To Index</button>

  <div class="story">
    <div id="storyBox"></div>
	<BR>
    <button class="storyButton" onclick="copyStory()">Copy Story</button>
  </div>

<button id="openNewTab">Open Outcome Page</button>

<hr>


<h1>HP Tracker</h1>

  <!-- HP Tracker: two boxes side-by-side -->
  <div id="hpContainer">
    <div class="hp-box" id="partyBox">
	<div class="gray">
      <h3>Party</h3>
<hr>
	</div>
      <div id="partyRows"></div>
    </div>
    <div class="hp-box" id="enemyBox">
	<div class="gray">
      <h3>Enemy</h3>
<hr>
	</div>
      <div id="enemyRows"></div>
    </div>
  </div>

  <textarea id="copyBuffer"></textarea>

<div id="conditionButtons">
<div class="col">
  <button data-key="partyVictory">Full Party Victory</button>
  <button data-key="manDownFlee">Man Down Flee</button>
</div>

<div class="col">
  <button data-key="manDownVictory">Man Down Victory</button>
  <button data-key="partyFlee">Full Party Flee</button>
</div>

<div class="col">
  <button data-key="partyKill">Total Party Kill</button>
  <button data-key="fleeBeforeBattle">Flee Before Battle</button>
</div>
</div>

<div id="conditionText" class="narrative-box">
  <div id="narrativeContent"></div>
  <button id="copyNarrative">Copy Text</button>
</div>
<br>
<div class="continueButtons">
  <button data-href="n.html">Successful Flee</button>
  <button data-href="p.html">Full Party Victory</button>
</div>


</article>

<script>
  // 0) params & helpers
  const params = new URLSearchParams(window.location.search);
  const lc  = s => (s||"").toLowerCase();
  const cap = s => (s||"")[0]?.toUpperCase() + (s||"").slice(1);

  // pronouns (unchanged)
  function pronounSet(subj) {
    subj = lc(subj);
    if (subj==="she")  return {HeSheThey:"she", HimHerThem:"her", HisHerTheir:"her", HisHersTheirs:"hers", WasWere:"was", DoesDo:"does", HasHave:"has"};
    if (subj==="he")   return {HeSheThey:"he", HimHerThem:"him", HisHerTheir:"his", HisHersTheirs:"his", WasWere:"was", DoesDo:"does", HasHave:"has"};
    if (subj==="they") return {HeSheThey:"they", HimHerThem:"them", HisHerTheir:"their", HisHersTheirs:"theirs", WasWere:"were", DoesDo:"do",  HasHave:"have"};
    return           {HeSheThey:"it", HimHerThem:"it",  HisHerTheir:"its", HisHersTheirs:"its", WasWere:"was", DoesDo:"does", HasHave:"has"};
  }

  // ensure required params
  const required = [];
  for (let i=1; i<=4; i++) {
    ["Name","HeSheThey","Class","Weapon","Damage"]
      .forEach(f => required.push(`Player${i}${f}`));
  }
  if (required.some(k => !params.get(k))) {
    window.location.href = `fix.html?${params}`;
  }

  // 4) define globals for Player1…Player4 and build players[]
  const players = [];
  for (let i = 1; i <= 4; i++) {
    const rawName  = params.get(`Player${i}Name`)     || "";
    const rawPron  = params.get(`Player${i}HeSheThey`)|| "";
    const rawClass = params.get(`Player${i}Class`)    || "";
    const rawWeap  = params.get(`Player${i}Weapon`)   || "";
    const rawDmg   = params.get(`Player${i}Damage`)   || "";

    const Name      = cap(lc(rawName));
    const HeSheThey = lc(rawPron);
    const Class     = cap(lc(rawClass));
    const Weapon    = cap(lc(rawWeap));
    const Damage    = lc(rawDmg);

    const pfx       = pronounSet(HeSheThey);

    window[`Player${i}Name`]          = Name;
    window[`Player${i}HeSheThey`]     = pfx.HeSheThey;
    window[`Player${i}HimHerThem`]    = pfx.HimHerThem;
    window[`Player${i}HisHerTheir`]   = pfx.HisHerTheir;
    window[`Player${i}HisHersTheirs`] = pfx.HisHersTheirs;
    window[`Player${i}WasWere`]       = pfx.WasWere;
    window[`Player${i}DoesDo`]        = pfx.DoesDo;
    window[`Player${i}HasHave`]       = pfx.HasHave;
    window[`Player${i}Class`]         = Class;
    window[`Player${i}Weapon`]        = Weapon;
    window[`Player${i}Damage`]        = Damage;

    players.push({Name, HeSheThey, Class, Weapon, Damage});
  }


  // render top summary
  document.getElementById("customDisplay").innerHTML =
    players.map((p, i) =>
      `<strong>Player ${i+1}:</strong> ${p.Name} — <em>${p.HeSheThey}</em> | Class: ${p.Class} | Weapon: ${p.Weapon} | Damage: ${p.Damage}`
    ).join("<br>");

  // story injection
  const storyText = `Suddenly, a guttural roar, deep and resonant, ripped through the darkness from further within the cave. Their efforts to tiptoe past the hibernating beast had been utterly in vain. "Crap!" ${Player3Name} blurted out, the sound swallowed by the reverberating growl. 

"Ready your weapons!"  ${Player2Name} commanded, ${Player2HisHerTheir} voice tight with adrenaline. 

In the flickering beam of their light, a massive, shaggy form began to resolve itself from the shadows. The bear, a hulking silhouette of fury, lumbered forward, its eyes, twin points of malice, catching the light with an unnerving twinkle. With another stone-shaking roar, the creature surged towards them, their backs now pressed firmly against the cold, unyielding brambles of the blockage behind them. They have no choice but to fight for survival!
`;
  document.getElementById("storyBox").innerText = storyText;

  function copyStory(){
    navigator.clipboard.writeText(storyText)
      .then(_=>alert("Story copied!"))
      .catch(_=>alert("Copy failed."));
  }

 function renderHPTracker() {
  const partyDiv = document.getElementById("partyRows");
  const enemyDiv = document.getElementById("enemyRows");
  partyDiv.innerHTML = "";
  enemyDiv.innerHTML = "";

players.forEach(p => {
const maxLength = 20;
const displayName = p.Name.length > maxLength
  ? p.Name.slice(0, maxLength) + "…"
  : p.Name;

  const row = document.createElement("div");
  row.className = "hp-entry";

  row.innerHTML = `
    <div class="hp-left">
      <span class="name">${displayName}</span>
    </div>
    <div class="hp-right">
      <input type="number" class="current-hp" value="10" min="0" placeholder="Current">/
      <input type="number" class="max-hp" value="10" min="1" placeholder="Max">
      <label class="dead-toggle">
        <input type="checkbox" title="Dead?">
        ☠
      </label>
    </div>
  `;

  partyDiv.appendChild(row);
});



  // enemy row
  const m = document.createElement("div");
  m.className = "hp-entry";
  m.innerHTML = `
    <div class="hp-left">
      <span class="name">Sleeping Bear</span>
    </div>


    <div class="hp-right">
      <input type="number" class="current-hp" value="30" min="0" placeholder="Current">/
      <input type="number" class="max-hp" value="30" min="1" placeholder="Max">
      <label class="dead-toggle">
        <input type="checkbox" title="Dead?">
        ☠
      </label>
    </div>
  `;
  enemyDiv.appendChild(m);
}
renderHPTracker();


  // sync titles + nav helpers
  const title = "Tainted Spring: Bear Fight!";
  document.getElementById("pageTitle").innerText   = title;
  document.getElementById("promptTitle").innerText = title;

  function goToFix()    { window.location.href = `fix.html?${params}`; }
  function goToPage(pg){ window.location.href = `${pg}.html?${params}`; }

const conditionMap = {
  partyVictory: `The bear’s final howl of agony was cut short as it finally succumbed to its wounds. Its massive body crashed heavily to the cave floor, and then there was a ringing, sudden silence. The thrumming of your own heart and the ragged breathing of your surviving comrades were all that could be heard in the sudden calm. PLAYER lowered their sword, the shimmering light from their last magical attack fading from its blade. The threat was neutralized, the dark of the cavern no longer held the menace of a slumbering beast. Your small band had emerged victorious, bruised and exhausted, but wholly intact.`,
  manDownVictory: `The bear let out one last, ferocious roar before its bulk slumped to the ground with a final, heavy thud. The party had won, but at a cost. Amidst the sounds of heavy breathing and dripping water, a grim silence fell over the heroes. PLAYER, wiping blood and sweat from their brow, looked over to see two of their comrades lying still on the cold, unforgiving floor, their unconscious forms a stark reminder of the battle's ferocity. With heavy hearts and sore limbs, they and the other survivors had to abandon the quest. There was nothing left to do but carefully carry their fallen friends back to the village, their victory tainted by failure. Another party would have to finish what they had started, and all that remained for them was the long walk home with the weight of loss on their shoulders.`,
  partyKill: `One by one, the adventurers fell, the angry bear's roars and clawed fury too overwhelming for their meager defenses. The last to stand was PLAYER, their sword arm heavy, their light magic exhausted. A final, desperate attack was brushed aside with a powerful swipe of the bear's paw, sending PLAYER's body crashing into the lifeless form of a fallen companion. With the last of the interlopers silenced, a heavy, panting stillness fell over the cavern. The great bear sniffed the still forms of its victims, a guttural purr rumbling in its chest. It then began the slow, methodical process of dragging the bodies deeper into the blackness, adding them to its gruesome food pile in preparation for its long sleep.

Two days later, the next party of adventurers were sent in to find them. They stumbled upon the mire and found the adventurers barely alive, in the depths of the bear’s cave. They rescued them from the bear, healed their most grievous wounds and carefully brought them back to Prairiedale village where they could be treated more thoroughly by healers.
`,
  manDownFlee: `The bear's fury was overwhelming, and one by one, companions fell, their bodies lying still on the cold, hard ground. Realizing the fight was lost and survival was now the only goal, PLAYER made the agonizing decision to flee. With the help of the last standing allies, they dragged the unconscious forms of their friends towards the dense wall of brambles blocking a side passage. It was a desperate struggle, with the bear's growls echoing closer and closer as they tore through the thorns, but they eventually made it through, pulling their downed comrades with them. There was no time to think of victory or the quest, only the burning need to get their injured friends back to safety. With heavy hearts and the bitter taste of failure, they left the cave, knowing another party would have to finish their abandoned mission.`,
  partyFlee: `The air was thick with the scent of pine and rage as the bear pressed its relentless assault. Knowing they couldn't win this fight, PLAYER shouted a desperate command to retreat. They and their companions turned as one, abandoning the fight and scrambling towards a dense wall of brambles that blocked a side passage. With a combined effort of hacking swords, desperate pulls, and even a burst of force, they tore through the thorny barricade just as the enraged bear reached them. Stumbling through the gap, they didn't look back, adrenaline fueling their desperate flight deeper into the maze-like cave, hoping the beast wouldn't follow.`,
  fleeBeforeBattle: `They cannot flee before the fight starts.`
};

const contentBox = document.getElementById("narrativeContent");

document.getElementById("conditionButtons").addEventListener("click", e => {
  if (e.target.tagName !== "BUTTON") return;

  const key = e.target.dataset.key;
  const text = conditionMap[key] || "No narrative available.";
  contentBox.textContent = text;
});

document.getElementById("copyNarrative").addEventListener("click", () => {
  const text = contentBox.textContent.trim();
  if (!text) return;

  const btn = document.getElementById("copyNarrative");

  navigator.clipboard.writeText(text)
    .then(() => {
      btn.textContent = "Copied!";
      setTimeout(() => {
        btn.textContent = "Copy Text";
      }, 1500);
    })
    .catch(() => {
      btn.textContent = "Copy failed";
      setTimeout(() => {
        btn.textContent = "Copy Text";
      }, 1500);
    });
});

document.querySelectorAll(".continueButtons button").forEach(btn => {
  btn.addEventListener("click", () => {
    const baseURL = btn.dataset.href;
    const currentParams = window.location.search; // includes the "?" prefix
    const fullURL = baseURL + currentParams;
    window.location.href = fullURL;
  });
});

document.getElementById("openNewTab").addEventListener("click", () => {
  const targetURL = "https://perchance.org/tainted-spring-battle-sim-2-bear-attack"; // replace with your actual link
  const currentParams = window.location.search;
  const fullURL = targetURL + currentParams;

  window.open(fullURL, "_blank");
});



</script>
</body>
</html>
