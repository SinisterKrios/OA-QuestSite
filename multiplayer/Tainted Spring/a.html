<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title id="pageTitle">Multiplayer Prompt</title>
  <link rel="stylesheet" href="../../style.css">
  <style>
/* container and segment sizing */
.story {
  max-width: 1000px;
  margin: 0 auto;
}

.story-segment {
  background: #676767;            /* match your dark box look if needed */
  color: #eee;
  border-radius: 6px;
  padding: 1rem;
  margin: 0.75rem 0;
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
}

/* preserve newlines but allow wrapping so lines don't grow horizontally */
.story-segment pre {
  white-space: pre-wrap;      /* preserves newlines and allows wrapping */
  word-break: break-word;
  margin: 0;
  font-family: serif;         /* match your aesthetic from template */
  line-height: 1.4;
  max-height: 240px;          /* limit visible height */
  overflow: auto;             /* enable internal scrolling if needed */
  padding-right: 0.25rem;     /* room for scrollbar */
}

/* keep the copy button sized and aligned */
.story-segment .storyButton {
  align-self: flex-end;
  padding: 0.35rem 0.8rem;
  font-size: 0.95rem;
  border-radius: 6px;
  width: auto;
  min-width: 72px;
background-color: #303030;
}


    .button-group {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: auto;
    }
    #copyBuffer {
      position: absolute;
      left: -9999px;
    }
    .option-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-top: 30px;
    }
    .option-box {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: #676767;
      border: 2px solid #303030;
      border-radius: 8px;
      padding: 15px;
      text-align: left;
      min-height: 280px;
    }
    .option-box h3 {
      margin-top: 0;
      color: #ffffff;
    }
    .option-box p {
      margin: 8px 0;
    }
    .result-box {
      display: none;
      margin-top: 30px;
      background: #676767;
      border: 2px solid #303030;
      border-radius: 8px;
      padding: 20px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }
    .result-box h3 {
      margin-top: 0;
      color: #ffffff;
    }
    #resultActions {
      margin: 15px 0;
    }
	button{
		color: white;
}
.option-grid{
	background-color: #303030;
	padding: 20px;
}
.option-box button{
	background-color: #303030;
}

/* container: place buttons side-by-side */
.button-group, #resultActions{
  display: flex;
  gap: 10px;
  align-items: stretch; /* ensure children fill cross axis */
}

/* make every button share space and have identical height */
.button-group .storyButton, #resultActions button{
  flex: 1 1 0;         /* grow and shrink equally, no base width bias */
  min-width: 0;        /* allow proper shrinking inside grid */
  box-sizing: border-box;
  height: 48px;        /* fixed height so all match exactly */
  padding: 0 1rem;     /* horizontal padding only (vertical controlled by height) */
  display: inline-flex;
  align-items: center; /* center label vertically */
  justify-content: center;
  border-radius: 8px;
background-color: #303030;
}

.option-box hr{
  border: none;
  height: 1px;
  background: #ccc;        /* line color */
  margin: 0;          /* spacing */
  display: block;  
}

  </style>
</head>
<body class="prompt">
<article>
<div class="container">

<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">
  <div>
  <h2 id="promptTitle">Tainted Springs: Muddy Path</h2>
  <p>By Tenshilove</p>
</div>
<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">

</div>

<hr>

  <div id="customDisplay"></div>
  <button class="storyButton" onclick="goToFix()">Fix Parameters</button>
  <button class="storyButton" onclick="goToPage('index')">To Index</button>

  <div class="story">
    <div id="storyBox"></div>
    <button class="storyButton" onclick="copyStory()">Copy Story</button>
  </div>

  <div class="option-grid" id="optionGrid"></div>

  <div class="result-box" id="resultBox">
    <h3 id="resultTitle"></h3>
    <p id="resultText"></p>
    <div id="resultActions"></div>
  </div>

  <textarea id="copyBuffer"></textarea>
</article>

<script>
  // 0) pull URL params
  const params = new URLSearchParams(window.location.search);

  // 1) simple casing helpers
  const lc  = s => (s||"").toLowerCase();
  const cap = s => (s||"")[0]?.toUpperCase() + (s||"").slice(1);

  // 2) pronounSet → flat keys your template expects
  function pronounSet(subj) {
    subj = lc(subj);
    switch (subj) {
      case "she":  return { HeSheThey:"she", HimHerThem:"her", HisHerTheir:"her", HisHersTheirs:"hers", WasWere:"was", DoesDo:"does", HasHave:"has" };
      case "he":   return { HeSheThey:"he",  HimHerThem:"him",  HisHerTheir:"his",  HisHersTheirs:"his", WasWere:"was",  DoesDo:"does", HasHave:"has" };
      case "they": return { HeSheThey:"they",HimHerThem:"them",HisHerTheir:"their",HisHersTheirs:"theirs",WasWere:"were", DoesDo:"do",  HasHave:"have" };
      default:     return { HeSheThey:"it",  HimHerThem:"it",   HisHerTheir:"its", HisHersTheirs:"its", WasWere:"was",  DoesDo:"does", HasHave:"has" };
    }
  }

  // 3) ensure we got all params
  const required = [];
  for (let i = 1; i <= 4; i++) {
    required.push(
      `Player${i}Name`,
      `Player${i}HeSheThey`,
      `Player${i}Class`,
      `Player${i}Weapon`,
      `Player${i}Damage`
    );
  }
  if (required.some(k => !params.get(k))) {
    window.location.href = `fix.html?${params}`;
  }

  // 4) define real globals for Player1…Player4
  const players = [];
  for (let i = 1; i <= 4; i++) {
    const rawName  = params.get(`Player${i}Name`)    || "";
    const rawPron  = params.get(`Player${i}HeSheThey`)|| "";
    const rawClass = params.get(`Player${i}Class`)   || "";
    const rawWeap  = params.get(`Player${i}Weapon`)  || "";
    const rawDmg   = params.get(`Player${i}Damage`)  || "";

    const Name      = cap(lc(rawName));
    const HeSheThey = lc(rawPron);
    const Class     = cap(lc(rawClass));
    const Weapon    = cap(lc(rawWeap));
    const Damage    = lc(rawDmg);

    const pfx = pronounSet(HeSheThey);

    // expose as globals
    window[`Player${i}Name`]          = Name;
    window[`Player${i}HeSheThey`]     = pfx.HeSheThey;
    window[`Player${i}HimHerThem`]    = pfx.HimHerThem;
    window[`Player${i}HisHerTheir`]   = pfx.HisHerTheir;
    window[`Player${i}HisHersTheirs`] = pfx.HisHersTheirs;
    window[`Player${i}WasWere`]       = pfx.WasWere;
    window[`Player${i}DoesDo`]        = pfx.DoesDo;
    window[`Player${i}HasHave`]       = pfx.HasHave;
    window[`Player${i}Class`]         = Class;
    window[`Player${i}Weapon`]        = Weapon;
    window[`Player${i}Damage`]        = Damage;

    // also collect into players[] for the top display
    players.push({Name, HeSheThey, Class, Weapon, Damage});
  }

  // 5) render the top summary
  document.getElementById("customDisplay").innerHTML =
    players.map((p, i) =>
      `<strong>Player ${i+1}:</strong> ${p.Name} — 
       <em>${p.HeSheThey}</em> | Class: ${p.Class} | Weapon: ${p.Weapon} | Damage: ${p.Damage}`
    ).join("<br>");

  // --- NEW: storyText with delimiter and per-segment copy buttons ---
  const storyText = `The young adventurers stood at the fork in the path, their packs slung comfortably, their spirits high.  "Muddy path it is!" declared ${Player1Name} already halfway down it. The others followed, their hooves and boots sinking almost immediately into the mire.

The first few steps were a comical ballet of near-falls. ${Player2Name}, usually quite steady, let out a surprised yelp as ${Player2HisHerTheir}  hoof shot out from under ${Player2HimHerThem}. ${cap(Player2HeSheThey)} managed to regain ${Player2HisHerTheir} balance, but ${Player2HisHerTheir} tunic was now splattered. 

A moment later, it was ${Player3Name} 's turn. ${cap(Player3HisHerTheir)} leg got stuck, and with a soft plop, ${Player2HeSheThey} tumbled backward, landing squarely in a patch of particularly thick, squelching mud. ${cap(Player3HeSheThey)} emerged, looking like a mud golem, ${Player3HisHerTheir} brightly colored adventuring gear now stained a dull, earthy brown. 

${Player1Name} burst into laughter, quickly followed by the others. 

"Alright, mud-monster!" ${Player4Name} chuckled. "Maybe we should stick together," ${Player4HeSheThey}  suggested, wiping a tear of laughter from ${Player4HisHerTheir} eye. "Hold onto each other, a bit of a mud-train, so no one pulls a ${Player3Name} again." 

They linked arms, giggling as their collective weight and coordinated (or delightfully uncoordinated) movements made the treacherous path feel more like a fun challenge. They moved slowly, a multi-aries centipede, slipping and sliding but always catching each other before anyone could take another unplanned mud bath.

Their laughter died down, however, as they reached a sudden, daunting expanse. The mud here wasn't just squelchy; it was a vast, viscous lake, glinting ominously. In the middle, the surface seemed to ripple, hinting at a deep, unseen pit beneath. It was too wide to jump, too deep to simply wade through without risking a truly nasty fall into whatever unknown depths awaited. They stood at the edge, their linked arms momentarily forgotten as they stared at the challenge.

"Right, this is a bit trickier than 'just keep walking'," ${Player4Name} admitted, frowning. 
The brave adventurers looked from the swirling mud to each other, their proposed plans buzzing in the air. The mud pit waited, silently challenging them to pick a path forward.
`.trim();

  // split into segments and render them with copy buttons
  const delimiter = "←—------------------- copy break—----------------->";
  const segments  = storyText.split(delimiter);
  const storyBox  = document.getElementById("storyBox");

  storyBox.innerHTML = ""; // clear

  segments.forEach((text) => {
    const trimmed = text.trim();
    if (!trimmed) return;

    const wrapper = document.createElement("div");
    wrapper.className = "story-segment";

    const pre = document.createElement("pre");
    pre.textContent = trimmed;

    const btn = document.createElement("button");
    btn.type = "button";
    btn.textContent = "Copy";
    btn.className = "storyButton";
    btn.addEventListener("click", () => {
      navigator.clipboard.writeText(trimmed)
        .then(() => {
          btn.textContent = "Copied!";
          setTimeout(() => btn.textContent = "Copy", 1200);
        })
        .catch(() => {
          btn.textContent = "Copy failed";
          setTimeout(() => btn.textContent = "Copy", 1200);
        });
    });

    wrapper.append(pre, btn);
    storyBox.appendChild(wrapper);
  });

  // 7) actions & UI (unchanged from your template2)
  const actions = [
    {
      name:      "Brave the Mud",
      condition: "Always available",
      prompt:    `${Player3Name}, growing impatient, scoffed. "Seriously? Why the hesitation? Come on, it's just mud! We could just try to cross. Carefully, obviously. It can't be that deep." 

${Player2Name}, still sporting  ${Player2HisHerTheir} mud-splattered tunic, nudged ${Player3Name} playfully. "Oh, listen to our Braveheart here, ready to take a mud bath without worrying about a deep pit!“  `,
      result:    `The adventurers decided to brave the pit and save their resources. They cautiously entered into the mud pit and continued on their way, eyes pinned on the dry path at the end. They waded through the sludge. The thick substance was heavy on their bodies and gear as they struggled to cross. `,
      next:      { label: "Continue", url: "d" }
    },
    {
      name:      "Use Rope",
      condition: "Requires item: Rope",
      prompt:    `${Player4Name} scanned the trees above. "See that sturdy branch?" ${Player4HeSheThey} pointed to a thick limb stretching out over the mud pit. "If we tied our length of rope to it, we could swing across." `,
      result:    `They agreed to try the rope, to swing across the mud. ${Player1Name} took the rope and created a lasso, then (after a few attempts) was able to secure it around the overhanging branch. After giving it several good tugs,  ${Player1HeSheThey} attempted to cross. ${cap(Player1HisHerTheir)} hooves dug into the dry ground on the other side, successfully. 
		50% chance to fail or succeed:

		Succeed:
		After each of them landed, they threw the rope back for the next. Each swing invited held breaths and silent prayers for one another as they crossed. Thankfully it worked out, and the adventurers began to head down the path to continue, clean from mud (mostly) and safe. ${Player4Name} gave a cocky ‘I told you so’ as they went on, proud of ${Player4HisHerTheir} idea’s success.

		Fail:
		${Player1Name} got across and tossed the rope back to the other side so that ${Player2Name} could come next, but as ${Player2HeSheThey} attempted to grab the rope, it swung forward like a pendulum, and in ${Player2HisHerTheir} attempt to grab it,  ${Player2HeSheThey} fumbled forward and plopped into the mud. ${Player3Name} attempted not to laugh, but failed to stop ${Player3HimHerThem}self. The laughter waned as ${Player2Name} didn’t surface immediately. Then the rest of the party hurriedly began to shout for them before wading into the mud themselves to save ${Player2HimHerThem}! ${Player1Name} grabbed ahold of ${Player2Name} and pulled ${Player2HimHerThem} up! ${cap(Player2HeSheThey)} gasped for air. ${Player2HeSheThey} are okay, but now all of the adventurers are in the mud.
`,
      next: [
        { label: "Fail",    url: "d" },
        { label: "Succeed", url: "e" }
      ]
    },
    {
      name:      "Use Bucket",
      condition: "Requires item: Bucket",
      prompt:    `${Player1Name} considered a safer solution and pulled out a small, wooden bucket. "Or," ${Player1HeSheThey} proposed, "we could use this to scoop out some of the thickest mud, maybe create a more solid, albeit narrow, path. It'd take a while, but it's probably the safest way to avoid any nasty surprises." `,
      result:    `The Adventurers decided to use the bucket to clear a path. Using the small bucket and a whole lot of teamwork, they filled the bucket with the wet moisture and casted it off into the forest around them, slowly draining the wetness from the muddy pit. After some time they had cleared a dry walkway, and carefully passed over it together. It worked, and they made it to the other side safe and dry. `,
      next:      { label: "Continue", url: "e" }
    },
    {
      name:      "Water Spell",
      condition: "Requires mage with water spell",
      prompt:    ` “Water Magic may be able to clear a way,” ${Player2Name} offered, thinking. “We could remove the moisture from the mud and create a hard path to walk on.”`,
      result:    `Using a spellbook and magnificent magical powers, **{MAGE}** chants the Water Spell incantation. The words were layered with magic and great mana. Raising both hands, the magic spell pulled the water from the mud and the wet swampy pit started to dry up. It worked! The adventurers were able to easily cross over the now friend and caked dirt.`,
      next:      { label: "Continue", url: "e" }
    }
  ];

  const grid     = document.getElementById("optionGrid");
  const resBox   = document.getElementById("resultBox");
  const resTitle = document.getElementById("resultTitle");
  const resText  = document.getElementById("resultText");
  const resAct   = document.getElementById("resultActions");

  actions.forEach((act, idx) => {
    const box = document.createElement("div");
    box.className = "option-box";
    box.innerHTML = `
      <h3>${act.name}</h3>
	<hr>
      <p><strong>Condition:</strong> ${act.condition}</p>
      <p>${act.prompt}</p>
      <div class="button-group">
        <button class="storyButton" onclick="showResult(${idx})">Proceed</button>
        <button class="storyButton" onclick="copyPrompt(${idx})">Copy Prompt</button>
      </div>
    `;
    grid.appendChild(box);
  });

  function showResult(idx) {
    const act = actions[idx];
    resTitle.innerText = `Result: ${act.name}`;
    resText.innerText  = act.result;
    resAct.innerHTML   = "";

    const nexts = Array.isArray(act.next) ? act.next : [act.next];
    nexts.forEach(({label, url}) => {
      const btn = document.createElement("button");
      btn.className = "storyButton";
      btn.innerText = label;
      btn.onclick   = () => goToPage(url);
      resAct.appendChild(btn);
    });

    const copyBtn = document.createElement("button");
    copyBtn.className = "storyButton";
    copyBtn.innerText = "Copy Result";
    copyBtn.onclick   = copyResult;
    resAct.appendChild(copyBtn);

    resBox.style.display = "block";
  }

  function copyPrompt(idx) {
    navigator.clipboard.writeText(actions[idx].prompt)
      .then(() => alert("Prompt copied!"))
      .catch(() => alert("Copy failed."));
  }

  function copyResult() {
    navigator.clipboard.writeText(resText.innerText)
      .then(() => alert("Result copied!"))
      .catch(() => alert("Copy failed."));
  }

  const title = "Tainted Springs: Muddy Path";
  document.getElementById("pageTitle").innerText   = title;
  document.getElementById("promptTitle").innerText = title;

  function goToFix()    { window.location.href = `fix.html?${params}`; }
  function goToPage(pg){ window.location.href = `${pg}.html?${params}`; }

  // copy full story text
  function copyStory(){
    navigator.clipboard.writeText(storyText)
      .then(() => alert("Story copied!"))
      .catch(() => alert("Copy failed."));
  }
</script>

</body>
</html>

