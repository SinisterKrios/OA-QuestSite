<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title id="pageTitle">Multiplayer Prompt</title>
  <link rel="stylesheet" href="../../style.css">
  <style>
/* container and segment sizing */
.story {
  max-width: 1000px;
  margin: 0 auto;
}

.story-segment {
  background: #676767;            /* match your dark box look if needed */
  color: #eee;
  border-radius: 6px;
  padding: 1rem;
  margin: 0.75rem 0;
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
}

/* preserve newlines but allow wrapping so lines don't grow horizontally */
.story-segment pre {
  white-space: pre-wrap;      /* preserves newlines and allows wrapping */
  word-break: break-word;
  margin: 0;
  font-family: serif;         /* match your aesthetic from template */
  line-height: 1.4;
  max-height: 240px;          /* limit visible height */
  overflow: auto;             /* enable internal scrolling if needed */
  padding-right: 0.25rem;     /* room for scrollbar */
}

/* keep the copy button sized and aligned */
.story-segment .storyButton {
  align-self: flex-end;
  padding: 0.35rem 0.8rem;
  font-size: 0.95rem;
  border-radius: 6px;
  width: auto;
  min-width: 72px;
background-color: #303030;
}


    .button-group {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: auto;
    }
    #copyBuffer {
      position: absolute;
      left: -9999px;
    }
    .option-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-top: 30px;
    }
    .option-box {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: #676767;
      border: 2px solid #303030;
      border-radius: 8px;
      padding: 15px;
      text-align: left;
      min-height: 280px;
    }
    .option-box h3 {
      margin-top: 0;
      color: #ffffff;
    }
    .option-box p {
      margin: 8px 0;
    }
    .result-box {
      display: none;
      margin-top: 30px;
      background: #676767;
      border: 2px solid #303030;
      border-radius: 8px;
      padding: 20px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }
    .result-box h3 {
      margin-top: 0;
      color: #ffffff;
    }
    #resultActions {
      margin: 15px 0;
    }
	button{
		color: white;
}
.option-grid{
	background-color: #303030;
	padding: 20px;
}
.option-box button{
	background-color: #303030;
}

/* container: place buttons side-by-side */
.button-group, #resultActions{
  display: flex;
  gap: 10px;
  align-items: stretch; /* ensure children fill cross axis */
}

/* make every button share space and have identical height */
.button-group .storyButton, #resultActions button{
  flex: 1 1 0;         /* grow and shrink equally, no base width bias */
  min-width: 0;        /* allow proper shrinking inside grid */
  box-sizing: border-box;
  height: 48px;        /* fixed height so all match exactly */
  padding: 0 1rem;     /* horizontal padding only (vertical controlled by height) */
  display: inline-flex;
  align-items: center; /* center label vertically */
  justify-content: center;
  border-radius: 8px;
background-color: #303030;
}

.option-box hr{
  border: none;
  height: 1px;
  background: #ccc;        /* line color */
  margin: 0;          /* spacing */
  display: block;  
}

  </style>
</head>
<body class="prompt">
<article>
<div class="container">

<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">
  <div>
  <h2 id="promptTitle"></h2>
  <p>By Tenshilove</p>
</div>
<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">

</div>

<hr>

  <div id="customDisplay"></div>
  <button class="storyButton" onclick="goToFix()">Fix Parameters</button>
  <button class="storyButton" onclick="goToPage('index')">To Index</button>

  <div class="story">
    <div id="storyBox"></div>
    <button class="storyButton" onclick="copyStory()">Copy Story</button>
  </div>

  <div class="option-grid" id="optionGrid"></div>

  <div class="result-box" id="resultBox">
    <h3 id="resultTitle"></h3>
    <p id="resultText"></p>
    <div id="resultActions"></div>
  </div>

  <textarea id="copyBuffer"></textarea>
</article>

<script>
  // 0) pull URL params
  const params = new URLSearchParams(window.location.search);

  // 1) simple casing helpers
  const lc  = s => (s||"").toLowerCase();
  const cap = s => (s||"")[0]?.toUpperCase() + (s||"").slice(1);

  // 2) pronounSet → flat keys your template expects
  function pronounSet(subj) {
    subj = lc(subj);
    switch (subj) {
      case "she":  return { HeSheThey:"she", HimHerThem:"her", HisHerTheir:"her", HisHersTheirs:"hers", WasWere:"was", DoesDo:"does", HasHave:"has" };
      case "he":   return { HeSheThey:"he",  HimHerThem:"him",  HisHerTheir:"his",  HisHersTheirs:"his", WasWere:"was",  DoesDo:"does", HasHave:"has" };
      case "they": return { HeSheThey:"they",HimHerThem:"them",HisHerTheir:"their",HisHersTheirs:"theirs",WasWere:"were", DoesDo:"do",  HasHave:"have" };
      default:     return { HeSheThey:"it",  HimHerThem:"it",   HisHerTheir:"its", HisHersTheirs:"its", WasWere:"was",  DoesDo:"does", HasHave:"has" };
    }
  }

  // 3) ensure we got all params
  const required = [];
  for (let i = 1; i <= 4; i++) {
    required.push(
      `Player${i}Name`,
      `Player${i}HeSheThey`,
      `Player${i}Class`,
      `Player${i}Weapon`,
      `Player${i}Damage`
    );
  }
  if (required.some(k => !params.get(k))) {
    window.location.href = `fix.html?${params}`;
  }

  // 4) define real globals for Player1…Player4
  const players = [];
  for (let i = 1; i <= 4; i++) {
    const rawName  = params.get(`Player${i}Name`)    || "";
    const rawPron  = params.get(`Player${i}HeSheThey`)|| "";
    const rawClass = params.get(`Player${i}Class`)   || "";
    const rawWeap  = params.get(`Player${i}Weapon`)  || "";
    const rawDmg   = params.get(`Player${i}Damage`)  || "";

    const Name      = cap(lc(rawName));
    const HeSheThey = lc(rawPron);
    const Class     = cap(lc(rawClass));
    const Weapon    = cap(lc(rawWeap));
    const Damage    = lc(rawDmg);

    const pfx = pronounSet(HeSheThey);

    // expose as globals
    window[`Player${i}Name`]          = Name;
    window[`Player${i}HeSheThey`]     = pfx.HeSheThey;
    window[`Player${i}HimHerThem`]    = pfx.HimHerThem;
    window[`Player${i}HisHerTheir`]   = pfx.HisHerTheir;
    window[`Player${i}HisHersTheirs`] = pfx.HisHersTheirs;
    window[`Player${i}WasWere`]       = pfx.WasWere;
    window[`Player${i}DoesDo`]        = pfx.DoesDo;
    window[`Player${i}HasHave`]       = pfx.HasHave;
    window[`Player${i}Class`]         = Class;
    window[`Player${i}Weapon`]        = Weapon;
    window[`Player${i}Damage`]        = Damage;

    // also collect into players[] for the top display
    players.push({Name, HeSheThey, Class, Weapon, Damage});
  }

  // 5) render the top summary
  document.getElementById("customDisplay").innerHTML =
    players.map((p, i) =>
      `<strong>Player ${i+1}:</strong> ${p.Name} — 
       <em>${p.HeSheThey}</em> | Class: ${p.Class} | Weapon: ${p.Weapon} | Damage: ${p.Damage}`
    ).join("<br>");

  // --- NEW: storyText with delimiter and per-segment copy buttons ---
  const storyText = `The adventurers had succumbed to the drowsy embrace of the enchanted flower field. Their slumber was a deep and peaceful oblivion that rendered them utterly unaware of the subtle magic stirring around them. One by one, then in a chorus of rustling petals, the flowers began to awaken. Tiny blooms, imbued with a natural magic, wriggled beneath each slumbering form, lifting them gently onto their vibrant, pulsing petals. Like a living procession, they were carried through the colorful field, a floral march towards a small, dimly lit hovel nestled at the edge of the glen.

A shiver ran through ${Player1Name}. ${cap(Player1HisHerTheir)} eyes fluttered open, then widened in bewildered confusion. Beside ${Player1HimHerThem},  ${Player2Name} grunted and stirred. ${Player3Name} let out a soft, surprised gasp as the petals beneath ${Player3HimHerThem} shifted. A disbelieving grin spread across  ${Player4Name}’s face as ${Player4HeSheThey} realized ${Player4HeSheThey} and ${Player4HisHerTheir} companions were being transported by a floral escort.

As the adventurers fully awakened, a collective gasp rippled through the group. The flowers, startled by their sudden awareness, scattered and retreated with a surprising swiftness, leaving them standing on the damp earth.

“What in the blazes just happened?” ${Player1Name} boomed, dusting ${Player1HimHerThem}  self off with a bewildered frown.

“I think,” ${Player4Name} chirped, a mischievous glint in  ${Player4HisHerTheir}  eye, “we’ve been flower-napped!”

They looked around, taking in their surroundings. They were in an enchanted glen, a place of ethereal beauty. Ancient willow trees, their branches heavy with blossoms that pulsed with a faint, otherworldly light, dotted the landscape. But a blanket of decay hung over the scene. The leaves of these magnificent trees were a sickly grey and brown, a stark contrast to the vibrant hues of the living flowers.

Leaning against a gnarled, dimly lit magical tree at the far side of the glen was a figure of deep agonizing sorrow. It was a dryad, a creature of nature’s essence, her skin cracked and transforming into rough bark, her once-radiant floral adornments wilting and fading. Her beauty was undeniable, but it was a beauty steeped in the agony of slow death.

She was too weak to stand, but her voice, a hoarse whisper like the rustling of dry leaves, found them. “Help me,” she struggled. “Please-” Each word was a labored effort, a plea for help.
The adventurers rushed towards her. “Oh no!”  ${Player2Name} gasps!
“What happened to you?!” ${Player3Name}  asks with hesitation to come closer to the deathly scene. 

“My  home tree is dying…” The Dryad rasped, “the trees in this sacred grove are dying.”

“Who did this to you?!”  ${Player1Name} asks, kneeling before the dying creature. 

“Our roots, seeking nourishment, have delved too deep, reaching the tainted water…” She struggled to explain. “A poison seeping from the very soil. It weakens us…”

“Oh, great Sage!” ${Player4HeSheThey} says, “We are here, sent on purpose to cure the spring! We will heal this land!”

A small gentle smile crossed her pained face. “Good Aries… it relieves me to hear this… but… I need something… more…”

“More?” The adventurers exchange glances. 

“What do you need?” ${Player1Name} asks gently.  

“This weakness has left me incapable of protecting something precious, something… vital. My seed, the promise of future life, has been stolen.” The dryad aches as she speaks. 

The adventurers’ faces contorted with shock. “Your seed?” ${Player2Name} whispered, ${Player2HisHerTheir} hand instinctively going to her ${Player2Weapon}. “What is that?”

“Dryad seeds,” ${Player3Name} explained, ${Player3HisHerTheir} voice soft with understanding, “are incredibly rare. A dryad produces them only once every few years. If nurtured, they grow into an infant dryad, a new guardian of the forest.”

Tears, like droplets of sap, welled in the dryad’s eyes and traced paths down her bark-like cheeks. Her voice cracked with despair. “Please,” she implored, her gaze sweeping over them, “you must help me, brave Aries. Bring back my child. I will reward you…”

With a monumental effort, she extended a hand. From her fingertips, with dwindling strength, she coaxed forth three small, luminous herbs, their leaves glowing with an inner light. She held them just out of reach. “These,” she rasped, “are the shiverpetal herbs. They can purify the tainted waters, heal the spring. But I will only give them to you if you return my precious seed.” She pulled the herbs away from them, holding them close to her chest. 

A murmur rippled through the adventurers.
`.trim();

  // split into segments and render them with copy buttons
  const delimiter = "←—------------------- copy break—----------------->";
  const segments  = storyText.split(delimiter);
  const storyBox  = document.getElementById("storyBox");

  storyBox.innerHTML = ""; // clear

  segments.forEach((text) => {
    const trimmed = text.trim();
    if (!trimmed) return;

    const wrapper = document.createElement("div");
    wrapper.className = "story-segment";

    const pre = document.createElement("pre");
    pre.textContent = trimmed;

    const btn = document.createElement("button");
    btn.type = "button";
    btn.textContent = "Copy";
    btn.className = "storyButton";
    btn.addEventListener("click", () => {
      navigator.clipboard.writeText(trimmed)
        .then(() => {
          btn.textContent = "Copied!";
          setTimeout(() => btn.textContent = "Copy", 1200);
        })
        .catch(() => {
          btn.textContent = "Copy failed";
          setTimeout(() => btn.textContent = "Copy", 1200);
        });
    });

    wrapper.append(pre, btn);
    storyBox.appendChild(wrapper);
  });

  // 7) actions & UI (unchanged from your template2)
  const actions = [
    {
      name:      "Help",
      condition: "Always available",
      prompt:    `“We must help her,” ${Player4Name} declared, ${Player4HisHerTheir} resolve firm. “Find her seed and return it to her, then use those herbs to heal the water source. It’s the right thing to do.”

${Player3Name}, however, was more hesitant. “It’s a detour. We’re on an important mission. Any time we waste is more time the villagers are sick and dying. This could cost us valuable time.”
`,
      result:    `The adventurers listened with sympathy as the dryad, her leaves wilted and her voice weak, told them of her stolen seed. ${Player1Name} stepped forward first, kneeling down to look her in the eye. "We'll help you," ${Player1HeSheThey} said firmly. "You have our word as heroes."

"But is there a risk?" ${Player2Name} asked, with a glance toward the direction of the polluted stream. "Our quest is for the spring. Can we afford to be sidetracked?"

"We couldn't leave her to die, could we?" ${Player3Name} countered, already unsheathing ${Player3HisHerTheir} sword. "It's the right thing to do."

The dryad, hearing ${Player3HisHerTheir} promise, wept with gratitude. "Thank you, thank you!" she had rasped. "The one who stole it was a man of Aries. He ran that way, about two hours ago." She pointed a trembling hand toward the forest path. With their resolve strengthened, the adventurers set off in the direction she indicated, a new and heartfelt purpose driving them forward.`,
      next:      { label: "Continue", url: "o" }
    },
    {
      name:      "Steal and run",
      condition: "Always available",
      prompt:    `“Perhaps,” ${Player2Name} piped up, ${Player2HisHerTheir} hand resting on ${Player2HisHerTheir} ${Player2Weapon}, “we could simply take the herbs. The dryad is too weak to stop us. We need those herbs for the spring.”

A collective groan met this suggestion. “Unbecoming of a hero, ${Player2Name},” ${Player1Name} grumbled, though ${Player1HisHerTheir} own gaze flickered towards the coveted herbs. “Stealing from a grieving mother? I could never.”`,
      result:    `The players saw the dryad's weak state and realized she would not give up the herbs willingly. "This is a waste of time," ${Player3Name} muttered, looking at the dying dryad with a cold calculation. "The village is more important."


"We can't just take them!" ${Player2Name} protested, though ${Player2HisHerTheir} voice held a note of desperation. "What kind of heroes would we be?"


${Player1Name}, however, was already moving toward the dryad. "A dead dryad is of no use to anyone. Neither is a thirsty village."

 ${cap(Player1HeSheThey)} grabbed her arms by the wrists, ignoring her pained cries and struggles. She was too weak to put up any real fight, and ${Player1HeSheThey} were able to pluck the herbs from her hands.


"We'll be back for your seed later!" ${Player4Name} called over ${Player4HisHerTheir} shoulder as they turned to leave. 

"Once the spring is healed!" The dryad sank to the ground, sobbing quietly into her wilted leaves as the adventurers, now in possession of the herbs, left the glen and headed toward the spring.`,
      next:      { label: "Continue", url: "p" }
    },
    {
      name:      "Trick and run",
      condition: "Always available",
      prompt:    `“What if we try to reason with her?” ${Player3Name} proposed sympathetically. “Perhaps if we promise to retrieve the seed, she might entrust us with the herbs now. We can then hurry to the spring and fulfill our end of the bargain afterwards.”`,
      result:    `The adventurers, wanting the herbs but unwilling to use force, decided on a different tactic. They approached the dryad with a show of sympathy. 

"We'll help you find your seed," ${Player2Name} said, ${Player2HisHerTheir} voice dripping with sincerity. "We promise."

"But you're so weak," ${Player1Name} added, holding out a hand. "Let us hold onto the herbs for safekeeping. You've already had something stolen once."

The dryad, her hope renewed, looked at them with trusting eyes. "Swear it," she whispered. "That you will bring my seed back right away." The adventurers solemnly swore their promise. She then told them where the thief had gone. "That way," she said, pointing a thin finger.

The adventurers dutifully headed in that direction, their faces grave. But once they were out of her sight, they glanced at one another, a glint of triumph in their eyes. 

"The seed can wait," ${Player3Name} said, tucking the stolen herbs into ${Player3HisHerTheir} pouch. The group changed course, heading for the spring with a new prize in hand.
 
`,
      next:      { label: "Continue", url: "p" }
    },
    {
      name:      "Heal and Go",
      condition: "A healer with a healing spell and the mana in which to cast it",
      prompt:    `A softer voice, belonging to HEALER gently interjected, “We could use healing magic to try and bolster her strength, perhaps buy her some time. It wouldn’t advance our journey, but to leave her to wither…”`,
      result:    `The adventurers, feeling the weight of the dryad's plight, wanted to help without sacrificing their primary quest. They reasoned that a healthy dryad might still give them the herbs, or at least survive until they returned.

HEALER stepped forward, channeling a powerful surge of healing magic into the dryad. The dryad felt the magic course through her, and a gasp of relief escaped her lips. She began to glow, and her wilted leaves became lush and green. "Oh!" she gasped, her sallow face brightening. 

"The pain... it's gone!" She lifted herself into the air, a magical aura surrounding her. "I feel amazing! Thank you, adventurers!" She turned to face the group, a newfound strength in her eyes. "I am going to go after that thief myself!" As a reward, she gave them the herbs. "Take these. Thank you, and I hope you are able to cure the spring quickly." With a joyful cry, she flew off to hunt down her stolen seed.`,
      next:      { label: "Continue", url: "p" }
    },
    {
      name:      "Nature spell to heal",
      condition: "A mage with a nature spell and the mana in which to cast it",
      prompt:    `The MAGE speaks up, “She is dying,” THEY say, “I have a nature spell that may be able to help.” `,
      result:    `The adventurers, feeling the weight of the dryad's plight, wanted to help without sacrificing their primary quest. They reasoned that a healthy dryad might still give them the herbs, or at least survive until they returned.

MAGE stepped forward, channeling their knowledge of nature magic to revitalize the dryad. The magic flowed into the dryad, bringing life back to her. She began to glow, and her wilted leaves became lush and green. 

Her sallow face brightened and became smooth and beautiful. With her renewed strength, she lifted off the ground. "Incredible!" she exclaimed, feeling the magic fill her with power. "I feel better than ever! Thank you, thank you!" She turned to the adventurers. 

"I am going to hunt down that thief myself!" She gave them the herbs. "Take these. And may you cure the spring quickly!" Then, with a joyful cry, she flew off to retrieve her stolen seed.`,
      next:      { label: "Continue", url: "p" }
    },
    {
      name:      "Leave",
      condition: "Requires mage with water spell",
      prompt:    `“Or,” ${Player1Name}  mused, eyes scanning the dying grove, “ We could return, after the spring is cured and help her with her seed then. It would allow us to continue our quest unhindered.”

At the mention of being left alone, the dryad cried out, a sound of pure anguish. “No! I… I cannot stand against you,” she wept, her voice trembling, “but I beg you, find my seed quickly! Some creatures… they seek to consume it. My child… it may already be too late!”

Her plea hung heavy in the air. “I can tell you where the thief went,” she whispered, her strength failing, “if you promise… promise you will not abandon my child.”
`,
      result:    `"We can't get sidetracked," ${Player1Name} had insisted, pointing toward the polluted stream with a grim expression. "A village depends on us."

"But she's dying," ${Player4Name} said, ${Player4HisHerTheir} voice filled with a conflicting mix of compassion and practicality. "What if she has no other way to get help?"


"Then she is truly unfortunate," ${Player2Name} had replied coldly. "But we have a mission. One dryad does not outweigh the entire village." The dryad's leaves wilted even further as she listened, and she fell back against her tree, a look of profound sorrow on her face.

Seeing her resolve, the adventurers, realizing she would never give up the herbs for anything but her seed, had made the tough choice to simply leave her behind. They felt a pang of guilt but knew they were doing the right thing for the many over the few. 

"We're sorry," ${Player3Name} said softly, though they didn't slow ${Player3HisHerTheir} pace. "We wish we could do more." Without another word, they turned and headed back toward the spring, leaving the beautiful glen and the grieving dryad behind them.`,
      next:      { label: "Continue", url: "p" }
    }
  ];

  const grid     = document.getElementById("optionGrid");
  const resBox   = document.getElementById("resultBox");
  const resTitle = document.getElementById("resultTitle");
  const resText  = document.getElementById("resultText");
  const resAct   = document.getElementById("resultActions");

  actions.forEach((act, idx) => {
    const box = document.createElement("div");
    box.className = "option-box";
    box.innerHTML = `
      <h3>${act.name}</h3>
	<hr>
      <p><strong>Condition:</strong> ${act.condition}</p>
      <p>${act.prompt}</p>
      <div class="button-group">
        <button class="storyButton" onclick="showResult(${idx})">Proceed</button>
        <button class="storyButton" onclick="copyPrompt(${idx})">Copy Prompt</button>
      </div>
    `;
    grid.appendChild(box);
  });

  function showResult(idx) {
    const act = actions[idx];
    resTitle.innerText = `Result: ${act.name}`;
    resText.innerText  = act.result;
    resAct.innerHTML   = "";

    const nexts = Array.isArray(act.next) ? act.next : [act.next];
    nexts.forEach(({label, url}) => {
      const btn = document.createElement("button");
      btn.className = "storyButton";
      btn.innerText = label;
      btn.onclick   = () => goToPage(url);
      resAct.appendChild(btn);
    });

    const copyBtn = document.createElement("button");
    copyBtn.className = "storyButton";
    copyBtn.innerText = "Copy Result";
    copyBtn.onclick   = copyResult;
    resAct.appendChild(copyBtn);

    resBox.style.display = "block";
  }

  function copyPrompt(idx) {
    navigator.clipboard.writeText(actions[idx].prompt)
      .then(() => alert("Prompt copied!"))
      .catch(() => alert("Copy failed."));
  }

  function copyResult() {
    navigator.clipboard.writeText(resText.innerText)
      .then(() => alert("Result copied!"))
      .catch(() => alert("Copy failed."));
  }

  const title = "Tainted Spring: Weeping Dryad";
  document.getElementById("pageTitle").innerText   = title;
  document.getElementById("promptTitle").innerText = title;

  function goToFix()    { window.location.href = `fix.html?${params}`; }
  function goToPage(pg){ window.location.href = `${pg}.html?${params}`; }

  // copy full story text
  function copyStory(){
    navigator.clipboard.writeText(storyText)
      .then(() => alert("Story copied!"))
      .catch(() => alert("Copy failed."));
  }
</script>

</body>
</html>

