<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title id="pageTitle">Multiplayer Prompt</title>
  <link rel="stylesheet" href="../../style.css">
  <style>
/* container and segment sizing */
.story {
  max-width: 1000px;
  margin: 0 auto;
}

.story-segment {
  background: #676767;            /* match your dark box look if needed */
  color: #eee;
  border-radius: 6px;
  padding: 1rem;
  margin: 0.75rem 0;
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
}

/* preserve newlines but allow wrapping so lines don't grow horizontally */
.story-segment pre {
  white-space: pre-wrap;      /* preserves newlines and allows wrapping */
  word-break: break-word;
  margin: 0;
  font-family: serif;         /* match your aesthetic from template */
  line-height: 1.4;
  max-height: 240px;          /* limit visible height */
  overflow: auto;             /* enable internal scrolling if needed */
  padding-right: 0.25rem;     /* room for scrollbar */
}

/* keep the copy button sized and aligned */
.story-segment .storyButton {
  align-self: flex-end;
  padding: 0.35rem 0.8rem;
  font-size: 0.95rem;
  border-radius: 6px;
  width: auto;
  min-width: 72px;
background-color: #303030;
}


    .button-group {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: auto;
    }
    #copyBuffer {
      position: absolute;
      left: -9999px;
    }
    .option-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-top: 30px;
    }
    .option-box {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: #676767;
      border: 2px solid #303030;
      border-radius: 8px;
      padding: 15px;
      text-align: left;
      min-height: 280px;
    }
    .option-box h3 {
      margin-top: 0;
      color: #ffffff;
    }
    .option-box p {
      margin: 8px 0;
    }
    .result-box {
      display: none;
      margin-top: 30px;
      background: #676767;
      border: 2px solid #303030;
      border-radius: 8px;
      padding: 20px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }
    .result-box h3 {
      margin-top: 0;
      color: #ffffff;
    }
    #resultActions {
      margin: 15px 0;
    }
	button{
		color: white;
}
.option-grid{
	background-color: #303030;
	padding: 20px;
}
.option-box button{
	background-color: #303030;
}

/* container: place buttons side-by-side */
.button-group, #resultActions{
  display: flex;
  gap: 10px;
  align-items: stretch; /* ensure children fill cross axis */
}

/* make every button share space and have identical height */
.button-group .storyButton, #resultActions button{
  flex: 1 1 0;         /* grow and shrink equally, no base width bias */
  min-width: 0;        /* allow proper shrinking inside grid */
  box-sizing: border-box;
  height: 48px;        /* fixed height so all match exactly */
  padding: 0 1rem;     /* horizontal padding only (vertical controlled by height) */
  display: inline-flex;
  align-items: center; /* center label vertically */
  justify-content: center;
  border-radius: 8px;
background-color: #303030;
}

.option-box hr{
  border: none;
  height: 1px;
  background: #ccc;        /* line color */
  margin: 0;          /* spacing */
  display: block;  
}

  </style>
</head>
<body class="prompt">
<article>
<div class="container">

<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">
  <div>
  <h2 id="promptTitle"></h2>
  <p>By Tenshilove</p>
</div>
<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">

</div>

<hr>

  <div id="customDisplay"></div>
  <button class="storyButton" onclick="goToFix()">Fix Parameters</button>
  <button class="storyButton" onclick="goToPage('index')">To Index</button>

  <div class="story">
    <div id="storyBox"></div>
    <button class="storyButton" onclick="copyStory()">Copy Story</button>
  </div>

  <div class="option-grid" id="optionGrid"></div>

  <div class="result-box" id="resultBox">
    <h3 id="resultTitle"></h3>
    <p id="resultText"></p>
    <div id="resultActions"></div>
  </div>

  <textarea id="copyBuffer"></textarea>
</article>

<script>
  // 0) pull URL params
  const params = new URLSearchParams(window.location.search);

  // 1) simple casing helpers
  const lc  = s => (s||"").toLowerCase();
  const cap = s => (s||"")[0]?.toUpperCase() + (s||"").slice(1);

  // 2) pronounSet → flat keys your template expects
  function pronounSet(subj) {
    subj = lc(subj);
    switch (subj) {
      case "she":  return { HeSheThey:"she", HimHerThem:"her", HisHerTheir:"her", HisHersTheirs:"hers", WasWere:"was", DoesDo:"does", HasHave:"has" };
      case "he":   return { HeSheThey:"he",  HimHerThem:"him",  HisHerTheir:"his",  HisHersTheirs:"his", WasWere:"was",  DoesDo:"does", HasHave:"has" };
      case "they": return { HeSheThey:"they",HimHerThem:"them",HisHerTheir:"their",HisHersTheirs:"theirs",WasWere:"were", DoesDo:"do",  HasHave:"have" };
      default:     return { HeSheThey:"it",  HimHerThem:"it",   HisHerTheir:"its", HisHersTheirs:"its", WasWere:"was",  DoesDo:"does", HasHave:"has" };
    }
  }

  // 3) ensure we got all params
  const required = [];
  for (let i = 1; i <= 4; i++) {
    required.push(
      `Player${i}Name`,
      `Player${i}HeSheThey`,
      `Player${i}Class`,
      `Player${i}Weapon`,
      `Player${i}Damage`
    );
  }
  if (required.some(k => !params.get(k))) {
    window.location.href = `fix.html?${params}`;
  }

  // 4) define real globals for Player1…Player4
  const players = [];
  for (let i = 1; i <= 4; i++) {
    const rawName  = params.get(`Player${i}Name`)    || "";
    const rawPron  = params.get(`Player${i}HeSheThey`)|| "";
    const rawClass = params.get(`Player${i}Class`)   || "";
    const rawWeap  = params.get(`Player${i}Weapon`)  || "";
    const rawDmg   = params.get(`Player${i}Damage`)  || "";

    const Name      = cap(lc(rawName));
    const HeSheThey = lc(rawPron);
    const Class     = cap(lc(rawClass));
    const Weapon    = cap(lc(rawWeap));
    const Damage    = lc(rawDmg);

    const pfx = pronounSet(HeSheThey);

    // expose as globals
    window[`Player${i}Name`]          = Name;
    window[`Player${i}HeSheThey`]     = pfx.HeSheThey;
    window[`Player${i}HimHerThem`]    = pfx.HimHerThem;
    window[`Player${i}HisHerTheir`]   = pfx.HisHerTheir;
    window[`Player${i}HisHersTheirs`] = pfx.HisHersTheirs;
    window[`Player${i}WasWere`]       = pfx.WasWere;
    window[`Player${i}DoesDo`]        = pfx.DoesDo;
    window[`Player${i}HasHave`]       = pfx.HasHave;
    window[`Player${i}Class`]         = Class;
    window[`Player${i}Weapon`]        = Weapon;
    window[`Player${i}Damage`]        = Damage;

    // also collect into players[] for the top display
    players.push({Name, HeSheThey, Class, Weapon, Damage});
  }

  // 5) render the top summary
  document.getElementById("customDisplay").innerHTML =
    players.map((p, i) =>
      `<strong>Player ${i+1}:</strong> ${p.Name} — 
       <em>${p.HeSheThey}</em> | Class: ${p.Class} | Weapon: ${p.Weapon} | Damage: ${p.Damage}`
    ).join("<br>");

  // --- NEW: storyText with delimiter and per-segment copy buttons ---
  const storyText = `The air in the Sage Forest was thick with the lingering scent of damp earth and decaying leaves. Still shaking the clinging mud from their hooves, the four adventurers trudged deeper into its verdant depths. ${Player1Name}  grumbled, wiping the muck from ${Player1HisHerTheir} fur. "Honestly, this mud is everywhere! It's practically cemented itself into my fur."

${Player2Name} chuckled. "Don't complain, ${Player1Name}. They say mud is good for your skin. It’s healing. Think of it that way."

"Healing mud?" ${Player3Name} snorted, dislodging a particularly stubborn clump from ${Player3HisHerTheir} ear. "More like hindering mud. I feel like I'm wearing a coat made of sludge." Laughter rippled through the group, a bright contradiction to the hushed rustling of the ancient trees. 

${Player4Name} laughs, "Perhaps you just need to embrace your inner swamp creature, ${Player3Name}! Roar like a toad, perhaps?"

Their jovial mood, however, was short-lived. As they rounded a bend, the forest floor abruptly changed. The vibrant green canopy gave way to a sickly, greyish hue. They had stumbled upon a grove where the majestic trees of the Sage Forest stood in grim silence, their bark scarred and discolored, draped in a sickening, black sludge. The air here was heavy, not with the scent of life, but with a foul, acrid odor.

"That black mud doesn't look very healing," observed ${Player1Name}. ${cap(Player1HisHerTheir)} normally keen senses were assailed by the unnatural wrongness of the place. The sludge coated the roots, creeping up the thick trunks like a parasitic vine, and in places, it seemed to seep into the very wood, burning through it with an unseen malevolence.

As ${Player2Name} curiously edged closer to a particularly ravaged oak, the tree seemed to stir. A gnarled branch, thick as a man's arm, snaked out with alarming speed, its rough bark scraping against ${Player2Name}'s fur. Before anyone could react, the branch had wrapped around ${Player2HimHerThem}, lifting ${Player3HimHerThem} unceremoniously off ${Player2HisHerTheir} feet. 

“${Player2Name}!!” The others shouted, readying their weapons. They swiftly attempted to grab hold of their friend but failed to get a grip before ${Player2HeSheThey} were lifted high into the boughs with a scream!


A face, etched with the agony of a thousand years, contorted itself from the very trunk of the tree. Another, and then another, on the surrounding trees. These weren't just dying trees; they were Ent, ancient protectors of the forest, now weeping and wailing, their voices a chorus of despair.

"Help us!" a collective, agonizing plea echoed through the grove. "Save our kin! This blight consumes us!"

${Player2Name}, dangling precariously, squirmed, fuelled by a primal fear. The black sludge crept close to their cape, steering through the fabric. The tree’s branches seemed to be tightening its grip, and the Trent's touch, though not physically crushing, radiated a chilling weakness.

Panic flickered in ${Player1Name}'s eyes, but ${Player1HeSheThey} quickly suppressed it. "We can't let ${Player2HimHerThem} fall!" ${Player1HeSheThey} cried, ${Player1HisHerTheir} voice taut with urgency.


The adventurers stood, a knot of uncertainty and burgeoning resolve. The fate of their friend, and the very souls of these ancient trees, hung in a delicate balance, caught between the suffocating grip of the black sludge and their own looming decision
`.trim();

  // split into segments and render them with copy buttons
  const delimiter = "←—------------------- copy break—----------------->";
  const segments  = storyText.split(delimiter);
  const storyBox  = document.getElementById("storyBox");

  storyBox.innerHTML = ""; // clear

  segments.forEach((text) => {
    const trimmed = text.trim();
    if (!trimmed) return;

    const wrapper = document.createElement("div");
    wrapper.className = "story-segment";

    const pre = document.createElement("pre");
    pre.textContent = trimmed;

    const btn = document.createElement("button");
    btn.type = "button";
    btn.textContent = "Copy";
    btn.className = "storyButton";
    btn.addEventListener("click", () => {
      navigator.clipboard.writeText(trimmed)
        .then(() => {
          btn.textContent = "Copied!";
          setTimeout(() => btn.textContent = "Copy", 1200);
        })
        .catch(() => {
          btn.textContent = "Copy failed";
          setTimeout(() => btn.textContent = "Copy", 1200);
        });
    });

    wrapper.append(pre, btn);
    storyBox.appendChild(wrapper);
  });

  // 7) actions & UI (unchanged from your template2)
  const actions = [
    {
      name:      "Use Nature Magic",
      condition: "A mage with a nature spell and the mana in which to cast it",
      prompt:    `${Player4Name}’s gaze swept across the afflicted grove, ${Player4HisHerTheir} mind racing for some way out of this situation. "Nature magic," ${Player4HeSheThey} stammered quickly, "MAGE, your nature magic may be helpful. Can you… can you mend them?"`,
      result:    `With a calm demeanor, MAGE approached the massive, sludge-covered tree, assuring it of THEIR peaceful intentions before reaching out toward the gaping wounds marring its trunk. Raising THEIR wand, THEY began to chant, and a soft, emerald luminescence bloomed from the tip, converging into motes of light that drifted towards the injured Ent. 

These glowing particles gently touched every damaged part of its bark, and the Ent, closing its bark-like eyes, felt a profound sense of healing wash over its being. As the nature magic coursed through it, the Ent slowly lowered ${Player2Name} onto the ground. With a voice like rustling leaves, it thanked them, declaring them free to continue their journey, and then retreated back into a regenerative slumber, its form now mended and its survival secured by their intervention.

As they pressed onward, ${Player1Name} turned to ${Player2Name}, "Are you alright?" 

${Player3Name} let out a frustrated sigh, "A waste of mana, really, being forced into that." 

But ${Player4Name} offered a more conciliatory thought, "Still, it's good we saved the Ent, even if we were put on the spot." With a shared, albeit grudging, resolve, they continued their quest to cleanse the tainted spring and protect the village.`,
      next:      { label: "Continue", url: "n" }
    },
    {
      name:      "Use Water Magic",
      condition: "A mage with a water spell and the mana in which to cast it",
      prompt:    ` MAGE buzzed excitedly. "Or water magic! We need to wash this filth away! I can try to summon a spray, but it might take time."`,
      result:    `MAGE, approaching the distressed Ent with soft assurances, raised THEIR wand. A sphere of pure water appeared at its tip, and with a gentle sweep, MAGE began to cleanse the corrupted sludge from the ancient tree’s trunk. The Ent winced as the healing waters touched its wounds, but the noxious slime soon dissolved into the dirt. While the damage inflicted by the poison would remain, no further harm would befall the ancient creature. With a grateful, though reluctant, nod, the Ent released PLAYER 2.

"Are you alright?" ${Player1Name} asked, ${Player1HisHerTheir} voice laced with concern.

"I'm fine," ${Player2Name} replied, brushing ${Player2HimHerThem}self off.

"That was ridiculous!" exclaimed ${Player3Name}. "Cornering us like that and forcing us to waste mana!"

${Player4Name} sighed, "Well, at least the Ent has a better chance now. Let's go. We need to find that spring before more damage is done." 

They hurried onward, their focus once again on their urgent quest to cleanse the tainted spring and save the village.
`,
      next:      { label: "Continue", url: "n" }
    },
    {
      name:      "Use Bucket",
      condition: "Requires item: Bucket",
      prompt:    `${Player3Name}, who had noticed a nearby stream, chimed in with rough determination. "I can fetch water from the brook with our bucket, but it’s a fair distance for each trip. We'd be here all day trying to clear it."`,
      result:    ` The adventurers quickly agreed on the plan: tainted water, while irritating, was better than corrosive sludge. They immediately cleared a direct path to the brooke, while ${Player1Name}  grabbed the bucket, and they worked in a frantic relay, splashing the murky water onto the ancient tree’s trunk. The Ent hissed, the splash of the equally tainted liquid clearly painful, but soon the corrosive slime released its grip and splattered harmlessly into the dirt. Though scarred, the Ent was saved from further damage. It reluctantly lowered the limb trapping their friend. "I thank you," it rumbled, releasing ${Player2Name}.

"${Player2Name}, are you okay?" asked ${Player3Name}, rushing over.

"I'm fine," ${Player2HeSheThey} replied, brushing off the remaining muck.

"How dare it corner us like that and make us waste so much time!" grumbled ${Player1Name}, tossing ${Player1HisHerTheir} bucket down in frustration.

Exhausted but relieved, they decided to press on. The Ent had a fighting chance, and now they needed to prevent the source of this sludge. They hurried toward the spring before more damage could be done.
`,
      next:      { label: "Continue", url: "n" }
    },
    {
      name:      "Mercy kill or burn the ents down",
      condition: "Lantern, or Fire magic (spell, mage, mana)",
      prompt:    `A darker thought crossed ${Player1Name}'s mind, and he voiced it hesitantly. "Perhaps… Perhaps we could end these Ents suffering? With a fire… or fire magic? A quick end to their pain?" The idea hung in the air, a stark contrast to the hope they had initially sought.

${Player4Name} shook ${Player4HisHerTheir} head grimly. "That is too unkind. We are heroes! The Ent are docile creatures. We cannot simply extinguish them." 

${Player3Name} looked at the Trent holding ${Player2Name}. "They sealed their fates when they captured ${Player2Name}. They can’t complain if we fight back!”`,
      result:    ` The adventurers made a grim but necessary choice: fire was the only way to save their companion and continue their quest to cure the tainted spring. (The MAGE raised THEIR WAND, the tip lighting up with crackling energy.) (${Player3Name} lit the lantern and broke the glass around it, exposing the flames.) "Release ${Player2Name} or else!" (THEY) (${Player1HeSheThey}) warned the mammoth Ent, which only replied with a deafening, resentful roar. 

As the ancient tree lashed its thick, dying branches, ${Player1Name} expertly parried the attack, fending off the sludge-tipped limbs. The (MAGE released the spell; a blinding fireball)(${Player3Name} threw down the lantern and it) struck the Ent’s trunk, instantly igniting the weak, polluted spots. 

With a shuddering groan, the Ent dropped its captive. ${Player3Name} sprinted forward, catching ${Player2Name} just before ${Player2HeSheThey} hit the ground.

 "Are you okay?" ${Player3Name} shouted through the roaring flames. "I'm fine!" ${Player2Name} replied, already scrambling back to ${Player2HisHerTheir} hooves. 

As the magical fire rushed through the Ent’s burning core, the four companions wasted no time. "Let's get the hell out of here!" ${Player4Name} urged, and they ran deeper into the forest, leaving the burning, felled guardian behind them screaming into the air.`,
      next:      { label: "Continue", url: "p" }
    },
    {
      name:      "Reason with ents",
      condition: "Always available",
      prompt:    `${Player1Name}, ${Player1HisHerTheir} brow furrowed in concentration, suggested, "What if we reason with it? The Ent are sentient. Perhaps if we explain our intentions… show we want to help…"

"And let the sludge burn straight through while we're politely requesting release?!" ${Player4Name} interjected, with sharp concern. 
`,
      result:    `${Player1Name}, ${Player1HisHerTheir} brow furrowed in concentration, suggested, "What if we reason with it? The Ent are sentient. Perhaps if we explain our intentions… show we want to help…"

"And let the sludge burn straight through while we're politely requesting release?!" ${Player4Name} interjected, with sharp concern. 
`,
      next:      { label: "Continue", url: "p" }
    },
    {
      name:      "Fight the ents",
      condition: "Always available",
      prompt:    `"We could just fight it! Force its branch to let go!" ${Player4Name} adds.`,
      result:    `"Fine," ${Player3Name} declared, drawing ${Player3HisHerTheir} ${Player3Weapon}. "If it won't cooperate, we'll make it."

With a shared nod, they advanced. The ent, sensing their intent, tried to lash out with a weak, trembling branch. It was a futile gesture. ${Player1Name}, swift and decisive, lunged forward, striking the already wounded trunk. A clean cut severed the branch holding ${Player2Name}, sending ${Player2HimHerThem} tumbling through the air. Before ${Player2HeSheThey} could hit the forest floor, ${Player3Name} was there, arms outstretched, catching ${Player2HimHerThem} with a firm grip.

${Player4Name}  sneered at the groaning ent. "That's what you get for attacking us for no reason," ${Player4HeSheThey} spat, before turning to continue the quest. Behind them, the quiet sobs of the dying ent echoed through the tainted woods. They had a village to save, and no time to mourn the forest's fallen.`,
      next:      { label: "Continue", url: "p" }
    },
    {
      name:      "Distract and run",
      condition: "Always available",
      prompt:    `${Player3Name} pointed ${Player3HisHerTheir}  finger towards the Trent. "Or, we could all charge it at once! Distract it, and maybe get ${Player2Name}  free while it's occupied."

"We have to get ${Player2Name} back," declared ${Player1Name}, eyeing the struggling ent with a mixture of pity and determination. 

"But we don't want to kill it," added ${Player3Name}, "especially if it's suffering." ${Player3Name} nodded in agreement.`,
      result:    `"Alright then," said ${Player1Name}, "we'll fight it just enough to make it let go, then we'll run. Agreed?"

 A chorus of assent followed, and the four adventurers charged. The ent, weakened by the very blight they sought to cure, swiped sluggishly with its branches.  ${Player3Name} dodged the clumsy blows while ${Player1Name} hacked at the tree limbs constricting ${Player2Name}. With a snap, the branches released their grip, and both ${Player2Name} and a piece of the ent tumbled to the ground. The adventurers quickly scrambled to their feet, free and unharmed. 

As they turned to retreat, the ent let out a pained cry, "Stop! Come back! Come back!" its voice echoing through the trees as the adventurers vanished into the dense forest.
`,
      next:      { label: "Continue", url: "p" }
    }
  ];

  const grid     = document.getElementById("optionGrid");
  const resBox   = document.getElementById("resultBox");
  const resTitle = document.getElementById("resultTitle");
  const resText  = document.getElementById("resultText");
  const resAct   = document.getElementById("resultActions");

  actions.forEach((act, idx) => {
    const box = document.createElement("div");
    box.className = "option-box";
    box.innerHTML = `
      <h3>${act.name}</h3>
	<hr>
      <p><strong>Condition:</strong> ${act.condition}</p>
      <p>${act.prompt}</p>
      <div class="button-group">
        <button class="storyButton" onclick="showResult(${idx})">Proceed</button>
        <button class="storyButton" onclick="copyPrompt(${idx})">Copy Prompt</button>
      </div>
    `;
    grid.appendChild(box);
  });

  function showResult(idx) {
    const act = actions[idx];
    resTitle.innerText = `Result: ${act.name}`;
    resText.innerText  = act.result;
    resAct.innerHTML   = "";

    const nexts = Array.isArray(act.next) ? act.next : [act.next];
    nexts.forEach(({label, url}) => {
      const btn = document.createElement("button");
      btn.className = "storyButton";
      btn.innerText = label;
      btn.onclick   = () => goToPage(url);
      resAct.appendChild(btn);
    });

    const copyBtn = document.createElement("button");
    copyBtn.className = "storyButton";
    copyBtn.innerText = "Copy Result";
    copyBtn.onclick   = copyResult;
    resAct.appendChild(copyBtn);

    resBox.style.display = "block";
  }

  function copyPrompt(idx) {
    navigator.clipboard.writeText(actions[idx].prompt)
      .then(() => alert("Prompt copied!"))
      .catch(() => alert("Copy failed."));
  }

  function copyResult() {
    navigator.clipboard.writeText(resText.innerText)
      .then(() => alert("Result copied!"))
      .catch(() => alert("Copy failed."));
  }

  const title = "Tainted Spring: Sludge Trees";
  document.getElementById("pageTitle").innerText   = title;
  document.getElementById("promptTitle").innerText = title;

  function goToFix()    { window.location.href = `fix.html?${params}`; }
  function goToPage(pg){ window.location.href = `${pg}.html?${params}`; }

  // copy full story text
  function copyStory(){
    navigator.clipboard.writeText(storyText)
      .then(() => alert("Story copied!"))
      .catch(() => alert("Copy failed."));
  }
</script>

</body>
</html>

