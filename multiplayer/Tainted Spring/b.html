<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title id="pageTitle">Multiplayer Prompt</title>
  <link rel="stylesheet" href="../../style.css">
  <style>
/* container and segment sizing */
.story {
  max-width: 1000px;
  margin: 0 auto;
}

.story-segment {
  background: #676767;            /* match your dark box look if needed */
  color: #eee;
  border-radius: 6px;
  padding: 1rem;
  margin: 0.75rem 0;
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
}

/* preserve newlines but allow wrapping so lines don't grow horizontally */
.story-segment pre {
  white-space: pre-wrap;      /* preserves newlines and allows wrapping */
  word-break: break-word;
  margin: 0;
  font-family: serif;         /* match your aesthetic from template */
  line-height: 1.4;
  max-height: 240px;          /* limit visible height */
  overflow: auto;             /* enable internal scrolling if needed */
  padding-right: 0.25rem;     /* room for scrollbar */
}

/* keep the copy button sized and aligned */
.story-segment .storyButton {
  align-self: flex-end;
  padding: 0.35rem 0.8rem;
  font-size: 0.95rem;
  border-radius: 6px;
  width: auto;
  min-width: 72px;
background-color: #303030;
}


    .button-group {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: auto;
    }
    #copyBuffer {
      position: absolute;
      left: -9999px;
    }
    .option-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-top: 30px;
    }
    .option-box {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: #676767;
      border: 2px solid #303030;
      border-radius: 8px;
      padding: 15px;
      text-align: left;
      min-height: 280px;
    }
    .option-box h3 {
      margin-top: 0;
      color: #ffffff;
    }
    .option-box p {
      margin: 8px 0;
    }
    .result-box {
      display: none;
      margin-top: 30px;
      background: #676767;
      border: 2px solid #303030;
      border-radius: 8px;
      padding: 20px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }
    .result-box h3 {
      margin-top: 0;
      color: #ffffff;
    }
    #resultActions {
      margin: 15px 0;
    }
	button{
		color: white;
}
.option-grid{
	background-color: #303030;
	padding: 20px;
}
.option-box button{
	background-color: #303030;
}

/* container: place buttons side-by-side */
.button-group, #resultActions{
  display: flex;
  gap: 10px;
  align-items: stretch; /* ensure children fill cross axis */
}

/* make every button share space and have identical height */
.button-group .storyButton, #resultActions button{
  flex: 1 1 0;         /* grow and shrink equally, no base width bias */
  min-width: 0;        /* allow proper shrinking inside grid */
  box-sizing: border-box;
  height: 48px;        /* fixed height so all match exactly */
  padding: 0 1rem;     /* horizontal padding only (vertical controlled by height) */
  display: inline-flex;
  align-items: center; /* center label vertically */
  justify-content: center;
  border-radius: 8px;
background-color: #303030;
}

.option-box hr{
  border: none;
  height: 1px;
  background: #ccc;        /* line color */
  margin: 0;          /* spacing */
  display: block;  
}

  </style>
</head>
<body class="prompt">
<article>
<div class="container">

<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">
  <div>
  <h2 id="promptTitle">Your Prompt Title Here</h2>
  <p>By Tenshilove</p>
</div>
<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">

</div>

<hr>

  <div id="customDisplay"></div>
  <button class="storyButton" onclick="goToFix()">Fix Parameters</button>
  <button class="storyButton" onclick="goToPage('index')">To Index</button>

  <div class="story">
    <div id="storyBox"></div>
    <button class="storyButton" onclick="copyStory()">Copy Story</button>
  </div>

  <div class="option-grid" id="optionGrid"></div>

  <div class="result-box" id="resultBox">
    <h3 id="resultTitle"></h3>
    <p id="resultText"></p>
    <div id="resultActions"></div>
  </div>

  <textarea id="copyBuffer"></textarea>
</article>

<script>
  // 0) pull URL params
  const params = new URLSearchParams(window.location.search);

  // 1) simple casing helpers
  const lc  = s => (s||"").toLowerCase();
  const cap = s => (s||"")[0]?.toUpperCase() + (s||"").slice(1);

  // 2) pronounSet → flat keys your template expects
  function pronounSet(subj) {
    subj = lc(subj);
    switch (subj) {
      case "she":  return { HeSheThey:"she", HimHerThem:"her", HisHerTheir:"her", HisHersTheirs:"hers", WasWere:"was", DoesDo:"does", HasHave:"has" };
      case "he":   return { HeSheThey:"he",  HimHerThem:"him",  HisHerTheir:"his",  HisHersTheirs:"his", WasWere:"was",  DoesDo:"does", HasHave:"has" };
      case "they": return { HeSheThey:"they",HimHerThem:"them",HisHerTheir:"their",HisHersTheirs:"theirs",WasWere:"were", DoesDo:"do",  HasHave:"have" };
      default:     return { HeSheThey:"it",  HimHerThem:"it",   HisHerTheir:"its", HisHersTheirs:"its", WasWere:"was",  DoesDo:"does", HasHave:"has" };
    }
  }

  // 3) ensure we got all params
  const required = [];
  for (let i = 1; i <= 4; i++) {
    required.push(
      `Player${i}Name`,
      `Player${i}HeSheThey`,
      `Player${i}Class`,
      `Player${i}Weapon`,
      `Player${i}Damage`
    );
  }
  if (required.some(k => !params.get(k))) {
    window.location.href = `fix.html?${params}`;
  }

  // 4) define real globals for Player1…Player4
  const players = [];
  for (let i = 1; i <= 4; i++) {
    const rawName  = params.get(`Player${i}Name`)    || "";
    const rawPron  = params.get(`Player${i}HeSheThey`)|| "";
    const rawClass = params.get(`Player${i}Class`)   || "";
    const rawWeap  = params.get(`Player${i}Weapon`)  || "";
    const rawDmg   = params.get(`Player${i}Damage`)  || "";

    const Name      = cap(lc(rawName));
    const HeSheThey = lc(rawPron);
    const Class     = cap(lc(rawClass));
    const Weapon    = cap(lc(rawWeap));
    const Damage    = lc(rawDmg);

    const pfx = pronounSet(HeSheThey);

    // expose as globals
    window[`Player${i}Name`]          = Name;
    window[`Player${i}HeSheThey`]     = pfx.HeSheThey;
    window[`Player${i}HimHerThem`]    = pfx.HimHerThem;
    window[`Player${i}HisHerTheir`]   = pfx.HisHerTheir;
    window[`Player${i}HisHersTheirs`] = pfx.HisHersTheirs;
    window[`Player${i}WasWere`]       = pfx.WasWere;
    window[`Player${i}DoesDo`]        = pfx.DoesDo;
    window[`Player${i}HasHave`]       = pfx.HasHave;
    window[`Player${i}Class`]         = Class;
    window[`Player${i}Weapon`]        = Weapon;
    window[`Player${i}Damage`]        = Damage;

    // also collect into players[] for the top display
    players.push({Name, HeSheThey, Class, Weapon, Damage});
  }

  // 5) render the top summary
  document.getElementById("customDisplay").innerHTML =
    players.map((p, i) =>
      `<strong>Player ${i+1}:</strong> ${p.Name} — 
       <em>${p.HeSheThey}</em> | Class: ${p.Class} | Weapon: ${p.Weapon} | Damage: ${p.Damage}`
    ).join("<br>");

  // --- NEW: storyText with delimiter and per-segment copy buttons ---
  const storyText = `The Adventurers choose the vine covered path, and they press forward. As the path goes on the vines become thicker and thicker. They are wild, gnarled, thorny vines, thick as their arms in places, writhing slowly as if possessed by a subtle, internal current. It was a formidable barrier, effectively blocking their passage. 

${Player2Name}, keen to test boundaries, had cautiously approached the thorny curtain, ${Player2HisHerTheir} hand outstretched. Faster than thought, a thick tendril, bristling with needle-sharp thorns, had lashed out, coiling around ${Player2HisHerTheir} ankle with surprising speed. A sharp yelp of surprise, a flash of panic, and then the strong pull from ${Player3Name} had yanked ${Player2HimHerThem} back, just as the vine began to tighten its unforgiving grip. A nasty scratch was all ${Player2HeSheThey}  sustained, thanks to ${Player2HisHerTheir} quick-thinking companion. They had all retreated a good ten feet, breathing heavily, their eyes fixed on the menacing, undulating foliage.
“Well, that was rather unwelcoming,” ${Player2Name} muttered, rubbing ${Player2HisHerTheir} bruised ankle, a wry smile failing to hide ${Player2HisHerTheir} lingering apprehension. 

${Player1Name}, ${Player1HisHerTheir} hand still resting on the hilt of ${Player1HisHerTheir} ${Player1Weapon}, frowned. "Unwelcoming, and effective. We're not getting through that without a solid plan." 

${Player3Name}, pointed ${Player3HisHerTheir} gnarled ${Player3Weapon} at the formidable obstruction. "It's not just a hedge, herd. It feels… alive, and not in a friendly way."

“They aren't the roots of an Ent. They must be enchanted somehow,” ${Player4Name},  considered the possibilities and took ${Player4HisHerTheir} manual of monsters from ${Player4HisHerTheir} pack to check. “Could be a Dryad or… maybe a Myco-ah!” A thorny vine lashed out at ${Player4HimHerThem} and knocked their book into the brambles, quickly swallowing it up in the vine.

“Stay alert, ${Player4Name}, !” ${Player1Name} says, cautiously, ${Player1HeSheThey}  poised ${Player1HisHerTheir} ${Player1Weapon} against the living thorns. They need a plan.

They exchanged glances, each adventurer weighing the risks and rewards. The path ahead was undeniably blocked, the options limited, and the stakes high. A wise decision wasn't just about choosing the easiest way, but the safest, the most efficient, and the one that would keep them together and moving forward. The thorny path waited, indifferent to their plight, and the party knew they couldn't linger for long.
`.trim();

  // split into segments and render them with copy buttons
  const delimiter = "←—------------------- copy break—----------------->";
  const segments  = storyText.split(delimiter);
  const storyBox  = document.getElementById("storyBox");

  storyBox.innerHTML = ""; // clear

  segments.forEach((text) => {
    const trimmed = text.trim();
    if (!trimmed) return;

    const wrapper = document.createElement("div");
    wrapper.className = "story-segment";

    const pre = document.createElement("pre");
    pre.textContent = trimmed;

    const btn = document.createElement("button");
    btn.type = "button";
    btn.textContent = "Copy";
    btn.className = "storyButton";
    btn.addEventListener("click", () => {
      navigator.clipboard.writeText(trimmed)
        .then(() => {
          btn.textContent = "Copied!";
          setTimeout(() => btn.textContent = "Copy", 1200);
        })
        .catch(() => {
          btn.textContent = "Copy failed";
          setTimeout(() => btn.textContent = "Copy", 1200);
        });
    });

    wrapper.append(pre, btn);
    storyBox.appendChild(wrapper);
  });

  // 7) actions & UI (unchanged from your template2)
  const actions = [
    {
      name:      "Go Around",
      condition: "Always available",
      prompt:    `${Player2Name} looked past the immediate entanglement into the denser thicket that bordered the path. "We could try to go around. Abandon the path for a bit, weave through the woods until we're past this thorny mess." ${cap(Player2HeSheThey)} paused

${Player3Name} added, "Though the woods themselves don't look particularly welcoming further in."

${Player1Name} clicks ${Player1HisHerTheir} tongue. “The brambles are probably only over this pathway. If we go far enough out of the way we could go around them.”

${Player3Name} interrupts, “They’re living vines, you think they will just let us go around? Obviously they will follow us.”

${Player4Name} counters, “No way to know unless we try.”`,
      result:    `The Aries decided to give up to the brambles and turned back, looking for an opportunity to go around them. However, everywhere they went the vines would pop out, as if they were following them and herding them away from the area.

Eventually they got so turned around by the harassing vines that they weren't fully sure which way they were meaning to go in the first place. They continued on.`,
      next:      { label: "Continue", url: "f" }
    },
    {
      name:      "Hack Through it with Swords",
      condition: "Requires item: Sword",
      prompt:    `"Or we could just hack at it," ${Player2Name} grumbled, hefting  ${Player2HisHerTheir} ${Player2Weapon}"It'll be slow, and we'll certainly take a few pricks, but we'll get through eventually. Better than setting the whole forest on fire, perhaps." ${Player2HeSheThey} eyed the dense, dry undergrowth around them with concern.`,
      result:    `50% chance to get either result.

The party agreed that hacking away was the best option. They readied their blade(s) and began to carefully approach the vines to hack at them. They had to act fast and stay alert to slash at the vines. A number of the vines grappled onto their arms and legs but together they covered each other’ backs and got through the bramble with scrapes and scratches all over them. When they reached the other side, they collapsed with relief and exhaustion in the dirt. ${Player2Name}  and ${Player1Name} who had collapsed beside one another reached out to give a weak, thorn torn high five. 

After a short rest, the party continued on.

(All players take 1 damage)


The party agreed that hacking away was the best option. They readied their blade(s) and began to carefully approach the vines to hack at them. They had to act fast and stay alert to slash at the vines. A number of the vines grappled onto their arms and legs.  ${Player3Name} screeched in pain and shock as several large and vicious vines wrapped around ${Player3HisHerTheir} legs and slammed them to the ground.

“${Player3Name}!!” ${Player1Name} yelped and grabbed onto ${Player3HimHerThem}. It took ${Player1HisHerTheir} full strength to wrench ${Player1HisHerTheir} ally from the vines. 

Panicked, the adventurers decided to retreat. They were overwhelmed by the vines. If they had gotten swallowed up by the thorns no amount of slashing would help. They decide instead to go back and find another path around the bramble.


`,
      next: [
        { label: "Made it",    url: "e" },
        { label: "Retreated", url: "f" }
      ]
    },
    {
      name:      "Use Fire Magic",
      condition: "Requires item: Mage with fire spell and mana to cast it",
      prompt:    `**MAGE**, the party's resident magic-wielder, had fingers already twitching with latent arcane energy. They spoke up first. "A good blaze would clear that right out. Burn a path, quick and hopefully clean." It was an appealing thought, a swift end to their thorny predicament. Their Magic reserves were limited, however.`,
      result:    `The adventurers agree, fire was the best course of action to clear a path. **MAGE** took out their **WEAPON** and recited the incantation of fire magic, their voice boomed with crackling magic as the air around the party heated up noticeably. A rush of hot flames is cast out from **MAGE**’s magic weapon and the vines caught fire immediately and began to burn away. After only a short moment the vines ahead of them were nothing more than charred remains that are easily squashed under hoof. The path was cleared and the party continued on.`,
      next:      { label: "Continue", url: "e" }
    },
    {
      name:      "Use Lantern",
      condition: "Requires lantern",
      prompt:    `${Player3Name}, spoke up. “Fire would be useful for burning through the vines. We have a lantern with oil and a striker.”

“Good thinking,” ${Player4Name} agreed and unhooked the lantern from ${Player4HisHerTheir} pack. “We can spill the oil and start a fire. It would use up the lantern oil, though.`,
      result:    `The adventurers decided that the lantern was the best option, and they carefully spilled out its oil on the vines, splashing it over a bramble path. Carefully ${Player1Name} held the lantern striker to the nearby oil slicked vine. The striker clicked and sparks flew out over the oil. ${Player1Name} leapt out of the way just in time to dodge the flaming vine’s grapple.The vines caught fire immediately and began to burn away. After only a short moment the vines ahead of them were nothing more than charred remains that are easily squashed under hoof. The path was cleared and the party continued on.`,
      next:      { label: "Continue", url: "e" }
    },
    {
      name:      "Use Flaming Sword",
      condition: "Requires flaming sword",
      prompt:    `**SWORDSMAN** drew the Magic Flaming blade from its holster, and spun it around fabulously. Flames spread over its blade heating up the surrounding area. **SWORDSMAN** cackles, “Easier done than said! I can burn through the vines with my magic blade! Stand aside!”`,
      result:    `The party agreed that **SWORDSMAN** should take the lead. They filed in behind them. The vines recoiled as they slashed through the plants easily and fires spread over the vines. In mere moments the living thorny bramble saw that it had been beaten and recoiled away, allowing them to pass. **SWORDSMAN** held out their blade, slashing and burning any vines that decided to get handsy. The party made it through unharmed.`,
      next:      { label: "Continue", url: "e" }
    },
    {
      name:      "Nature Spell",
      condition: "Requires mage with nature spell and mana to cast it",
      prompt:    `${Player3Name}, after a moment of thought, looked at **MAGE**. "What about your way, **MAGE**? Couldn't you… persuade them? You know, with your nature magic?" 

**MAGE** chewed their lip thoughtfully. "Perhaps, but these feel particularly stubborn and aggressive. It would take a lot of focus, and I'd be quite vulnerable while doing it. I’m worried it will provoke them to attack me."

(DM note: if player 3 is the mage, then swap them for the non mage character)`,
      result:    `Despite their reservations, the others urge **MAGE** to give it a shot. They conjure their magic, speaking the incantation to activate the nature spell. As their powerful words spread and affect the vines they start to writhe and swat around wildly.

“AHH!” ${Player1Name} is lashed violently by a vine (takes 2 damage)

The vines start to go berserk, moving towards the adventurers with a new found rage. The Aries panic and start to shout and run in a frenzy as the vines chase after them. 

They run for some time before they think the vines have given up. They cannot go back that way. After a short tense rest, they resolve to go another way and head cautiously back into the forest.`,
      next:      { label: "Continue", url: "f" }
    }
  ];

  const grid     = document.getElementById("optionGrid");
  const resBox   = document.getElementById("resultBox");
  const resTitle = document.getElementById("resultTitle");
  const resText  = document.getElementById("resultText");
  const resAct   = document.getElementById("resultActions");

  actions.forEach((act, idx) => {
    const box = document.createElement("div");
    box.className = "option-box";
    box.innerHTML = `
      <h3>${act.name}</h3>
	<hr>
      <p><strong>Condition:</strong> ${act.condition}</p>
      <p>${act.prompt}</p>
      <div class="button-group">
        <button class="storyButton" onclick="showResult(${idx})">Proceed</button>
        <button class="storyButton" onclick="copyPrompt(${idx})">Copy Prompt</button>
      </div>
    `;
    grid.appendChild(box);
  });

  function showResult(idx) {
    const act = actions[idx];
    resTitle.innerText = `Result: ${act.name}`;
    resText.innerText  = act.result;
    resAct.innerHTML   = "";

    const nexts = Array.isArray(act.next) ? act.next : [act.next];
    nexts.forEach(({label, url}) => {
      const btn = document.createElement("button");
      btn.className = "storyButton";
      btn.innerText = label;
      btn.onclick   = () => goToPage(url);
      resAct.appendChild(btn);
    });

    const copyBtn = document.createElement("button");
    copyBtn.className = "storyButton";
    copyBtn.innerText = "Copy Result";
    copyBtn.onclick   = copyResult;
    resAct.appendChild(copyBtn);

    resBox.style.display = "block";
  }

  function copyPrompt(idx) {
    navigator.clipboard.writeText(actions[idx].prompt)
      .then(() => alert("Prompt copied!"))
      .catch(() => alert("Copy failed."));
  }

  function copyResult() {
    navigator.clipboard.writeText(resText.innerText)
      .then(() => alert("Result copied!"))
      .catch(() => alert("Copy failed."));
  }

  const title = "Tainted Spring: Path Vines";
  document.getElementById("pageTitle").innerText   = title;
  document.getElementById("promptTitle").innerText = title;

  function goToFix()    { window.location.href = `fix.html?${params}`; }
  function goToPage(pg){ window.location.href = `${pg}.html?${params}`; }

  // copy full story text
  function copyStory(){
    navigator.clipboard.writeText(storyText)
      .then(() => alert("Story copied!"))
      .catch(() => alert("Copy failed."));
  }
</script>

</body>
</html>

