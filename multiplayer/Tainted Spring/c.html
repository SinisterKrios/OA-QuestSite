<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title id="pageTitle">Multiplayer Prompt</title>
  <link rel="stylesheet" href="../../style.css">
  <style>
/* container and segment sizing */
.story {
  max-width: 1000px;
  margin: 0 auto;
}

.story-segment {
  background: #676767;            /* match your dark box look if needed */
  color: #eee;
  border-radius: 6px;
  padding: 1rem;
  margin: 0.75rem 0;
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
}

/* preserve newlines but allow wrapping so lines don't grow horizontally */
.story-segment pre {
  white-space: pre-wrap;      /* preserves newlines and allows wrapping */
  word-break: break-word;
  margin: 0;
  font-family: serif;         /* match your aesthetic from template */
  line-height: 1.4;
  max-height: 240px;          /* limit visible height */
  overflow: auto;             /* enable internal scrolling if needed */
  padding-right: 0.25rem;     /* room for scrollbar */
}

/* keep the copy button sized and aligned */
.story-segment .storyButton {
  align-self: flex-end;
  padding: 0.35rem 0.8rem;
  font-size: 0.95rem;
  border-radius: 6px;
  width: auto;
  min-width: 72px;
background-color: #303030;
}


    .button-group {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: auto;
    }
    #copyBuffer {
      position: absolute;
      left: -9999px;
    }
    .option-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-top: 30px;
    }
    .option-box {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: #676767;
      border: 2px solid #303030;
      border-radius: 8px;
      padding: 15px;
      text-align: left;
      min-height: 280px;
    }
    .option-box h3 {
      margin-top: 0;
      color: #ffffff;
    }
    .option-box p {
      margin: 8px 0;
    }
    .result-box {
      display: none;
      margin-top: 30px;
      background: #676767;
      border: 2px solid #303030;
      border-radius: 8px;
      padding: 20px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }
    .result-box h3 {
      margin-top: 0;
      color: #ffffff;
    }
    #resultActions {
      margin: 15px 0;
    }
	button{
		color: white;
}
.option-grid{
	background-color: #303030;
	padding: 20px;
}
.option-box button{
	background-color: #303030;
}

/* container: place buttons side-by-side */
.button-group, #resultActions{
  display: flex;
  gap: 10px;
  align-items: stretch; /* ensure children fill cross axis */
}

/* make every button share space and have identical height */
.button-group .storyButton, #resultActions button{
  flex: 1 1 0;         /* grow and shrink equally, no base width bias */
  min-width: 0;        /* allow proper shrinking inside grid */
  box-sizing: border-box;
  height: 48px;        /* fixed height so all match exactly */
  padding: 0 1rem;     /* horizontal padding only (vertical controlled by height) */
  display: inline-flex;
  align-items: center; /* center label vertically */
  justify-content: center;
  border-radius: 8px;
background-color: #303030;
}

.option-box hr{
  border: none;
  height: 1px;
  background: #ccc;        /* line color */
  margin: 0;          /* spacing */
  display: block;  
}

  </style>
</head>
<body class="prompt">
<article>
<div class="container">

<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">
  <div>
  <h2 id="promptTitle">Your Prompt Title Here</h2>
  <p>By Tenshilove</p>
</div>
<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">

</div>

<hr>

  <div id="customDisplay"></div>
  <button class="storyButton" onclick="goToFix()">Fix Parameters</button>
  <button class="storyButton" onclick="goToPage('index')">To Index</button>

  <div class="story">
    <div id="storyBox"></div>
    <button class="storyButton" onclick="copyStory()">Copy Story</button>
  </div>

  <div class="option-grid" id="optionGrid"></div>

  <div class="result-box" id="resultBox">
    <h3 id="resultTitle"></h3>
    <p id="resultText"></p>
    <div id="resultActions"></div>
  </div>

  <textarea id="copyBuffer"></textarea>
</article>

<script>
  // 0) pull URL params
  const params = new URLSearchParams(window.location.search);

  // 1) simple casing helpers
  const lc  = s => (s||"").toLowerCase();
  const cap = s => (s||"")[0]?.toUpperCase() + (s||"").slice(1);

  // 2) pronounSet → flat keys your template expects
  function pronounSet(subj) {
    subj = lc(subj);
    switch (subj) {
      case "she":  return { HeSheThey:"she", HimHerThem:"her", HisHerTheir:"her", HisHersTheirs:"hers", WasWere:"was", DoesDo:"does", HasHave:"has" };
      case "he":   return { HeSheThey:"he",  HimHerThem:"him",  HisHerTheir:"his",  HisHersTheirs:"his", WasWere:"was",  DoesDo:"does", HasHave:"has" };
      case "they": return { HeSheThey:"they",HimHerThem:"them",HisHerTheir:"their",HisHersTheirs:"theirs",WasWere:"were", DoesDo:"do",  HasHave:"have" };
      default:     return { HeSheThey:"it",  HimHerThem:"it",   HisHerTheir:"its", HisHersTheirs:"its", WasWere:"was",  DoesDo:"does", HasHave:"has" };
    }
  }

  // 3) ensure we got all params
  const required = [];
  for (let i = 1; i <= 4; i++) {
    required.push(
      `Player${i}Name`,
      `Player${i}HeSheThey`,
      `Player${i}Class`,
      `Player${i}Weapon`,
      `Player${i}Damage`
    );
  }
  if (required.some(k => !params.get(k))) {
    window.location.href = `fix.html?${params}`;
  }

  // 4) define real globals for Player1…Player4
  const players = [];
  for (let i = 1; i <= 4; i++) {
    const rawName  = params.get(`Player${i}Name`)    || "";
    const rawPron  = params.get(`Player${i}HeSheThey`)|| "";
    const rawClass = params.get(`Player${i}Class`)   || "";
    const rawWeap  = params.get(`Player${i}Weapon`)  || "";
    const rawDmg   = params.get(`Player${i}Damage`)  || "";

    const Name      = cap(lc(rawName));
    const HeSheThey = lc(rawPron);
    const Class     = cap(lc(rawClass));
    const Weapon    = cap(lc(rawWeap));
    const Damage    = lc(rawDmg);

    const pfx = pronounSet(HeSheThey);

    // expose as globals
    window[`Player${i}Name`]          = Name;
    window[`Player${i}HeSheThey`]     = pfx.HeSheThey;
    window[`Player${i}HimHerThem`]    = pfx.HimHerThem;
    window[`Player${i}HisHerTheir`]   = pfx.HisHerTheir;
    window[`Player${i}HisHersTheirs`] = pfx.HisHersTheirs;
    window[`Player${i}WasWere`]       = pfx.WasWere;
    window[`Player${i}DoesDo`]        = pfx.DoesDo;
    window[`Player${i}HasHave`]       = pfx.HasHave;
    window[`Player${i}Class`]         = Class;
    window[`Player${i}Weapon`]        = Weapon;
    window[`Player${i}Damage`]        = Damage;

    // also collect into players[] for the top display
    players.push({Name, HeSheThey, Class, Weapon, Damage});
  }

  // 5) render the top summary
  document.getElementById("customDisplay").innerHTML =
    players.map((p, i) =>
      `<strong>Player ${i+1}:</strong> ${p.Name} — 
       <em>${p.HeSheThey}</em> | Class: ${p.Class} | Weapon: ${p.Weapon} | Damage: ${p.Damage}`
    ).join("<br>");

  // --- NEW: storyText with delimiter and per-segment copy buttons ---
  const storyText = `
The adventurers had chosen the rocky path. Bounding through the initial winding ascent, they moved with a careful grace, their hooves clattering softly, their ears perked for any tell of rocks shifting beneath their weight. 


"Watch your step, ${Player1Name}!" called ${Player4Name} as a loose stone tumbled harmlessly down the incline. ${Player1Name}, a touch more cautious, nodded, ${Player1HisHerTheir} dark eyes wide as ${Player1HeSheThey}  pressed a hoof firmly into the rock. They helped one another over the trickier outcrops, a camaraderie forged in shared purpose and a desire to be heroes.


The path soon narrowed, winding around a steep cliff face. A recent rock slide had gouged a cruel scar across the terrain, obliterating the easy trail. The ground that remained was treacherously unstable. As they climbed, the left side began to drop away sharply, until a sheer 20-foot chasm yawned beside them. On their right, the problem was reversed: a rugged, unyielding wall of rock rose, treacherous and unyielding. They were caught between a hard place and a very, very deep one.


"Whew, that's a fall," ${Player3Name} murmured, peering down. ${Player2Name}, nervously shifted ${Player2HisHerTheir} weight. "My head would split like a ripe melon if I went over that," ${Player1HeSheThey} whispered, a shiver running through ${Player2HimHerThem}.


${Player4Name} scoffed good-naturedly. "Don't be a coward, ${Player3Name}! Just keep your hooves on the ground."


${Player1Name} sighed. "I still wonder if the muddy path wouldn't have been safer."



${Player2Name} shook ${Player2HisHerTheir} head. "No chance, ${Player1Name}. The spring we're looking for is at the highest point. This is the only way up."


They pressed on, their hooves even more gingerly placed, until their progress was abruptly halted. The path simply wasn't there anymore. A short distance ahead, a gaping void cut the trail where another section had collapsed, revealing a deadly plummet into a jagged field of sharp rocks below. On the right, the sheer rock face offered little comfort, though a few gnarled, exposed roots and tiny ledges dotted its surface like forgotten handholds.


A heavy silence fell as they surveyed the impossible gap. "Alright, herd," ${Player4Name} finally declared, rubbing ${Player4HisHerTheir} chin. "What's the plan?"


The four adventurers looked at each other, a mix of apprehension, determination, and friendly exasperation on their faces. The wind whistled through the gap, a silent judge, as they began to debate their perilous options.

`.trim();

  // split into segments and render them with copy buttons
  const delimiter = "←—------------------- copy break—----------------->";
  const segments  = storyText.split(delimiter);
  const storyBox  = document.getElementById("storyBox");

  storyBox.innerHTML = ""; // clear

  segments.forEach((text) => {
    const trimmed = text.trim();
    if (!trimmed) return;

    const wrapper = document.createElement("div");
    wrapper.className = "story-segment";

    const pre = document.createElement("pre");
    pre.textContent = trimmed;

    const btn = document.createElement("button");
    btn.type = "button";
    btn.textContent = "Copy";
    btn.className = "storyButton";
    btn.addEventListener("click", () => {
      navigator.clipboard.writeText(trimmed)
        .then(() => {
          btn.textContent = "Copied!";
          setTimeout(() => btn.textContent = "Copy", 1200);
        })
        .catch(() => {
          btn.textContent = "Copy failed";
          setTimeout(() => btn.textContent = "Copy", 1200);
        });
    });

    wrapper.append(pre, btn);
    storyBox.appendChild(wrapper);
  });

  // 7) actions & UI (unchanged from your template2)
  const actions = [
    {
      name:      "Jump",
      condition: "Always available",
      prompt:    `The way across felt obvious to ${Player3Name}, “We can jump it.”  
${Player3HeSheThey} said, simple. 



${Player2Name} scoffed at that, “Okay, mountain goat, you wanna try? Go ahead.”`,
      result:    `50/50 result chance
 To ${Player2Name}’s surprise, ${Player3Name}  took a running start and with one long bound ${Player3HeSheThey} cleared the gap in the rocks. ${Player4Name} landed on one hoof and a knee and scrambled away from the crumbling edge. ${cap(Player3HeSheThey)} stood quickly and grinned with a proud brow wiggle. “Wanna say that again, ${Player2Name}?” ${Player3HeSheThey} chuckled. “Bet you can’t do that.”

“Oh yeah?!” ${Player2Name}’ snickers, challenge accepted. 

One by one the adventurers jump over the gap. They help one another over the gap and make it across just fine. It was close, but they are athletic aries, and continue on their quest feeling bolstered with confidence. 


${Player3Name}, filled with confidence, took a running start.

“Wait stop! You numbskull!” ${Player4Name} called out to ${Player3HimHerThem} but the warning fell on deaf ears as ${Player3Name} lept over the gap. 



${cap(Player3HeSheThey)} nearly made it across, but fell short by just a hair. As 
${Player3HeSheThey} plummeted into the tree bouts and brush below 
${Player3HeSheThey} took a moment to consider their decisions in life. ${Player2Name} snickered from above. 

The adventurers hurried down to the bottom of the cliff to help ${Player3Name} who had thankfully only suffered minor injuries and a whole lot of bruising to ${Player3HisHerTheir} ego. They decided it was best to continue on their quest going a different route.
`,
      next:      [
        { label: "Fall",    url: "f" },
        { label: "Make it", url: "g" }
      ]
    },
    {
      name:      "Use Rope",
      condition: "Requires item: Rope",
      prompt:    `
${Player1Name}  chimed in, "We could try using a rope. If we could get it around that large boulder on the cliff above us, one of us could rappel over and secure it for the others." ${cap(Player1HeSheThey)}  tapped ${Player1HisHerTheir} chin thoughtfully. "It's dangerous, though. A slip could mean a nasty injury."
`,
      result:    `50/50% result chance

They choose to try the rope swinging method. With some finesse and a few tries, ${Player1Name} got the lasso of rope to tighten around a large sturdy rock that was jutting out from the top of the cliff face. 
${cap(Player1HeSheThey)} gave the rope a few strong tugs to test it’s hold and when ${Player1HeSheThey} ${Player1WasWere}  sure that it’s secure ${Player1HeSheThey} take the first swing over the gap. ${cap(Player1HeSheThey)} ${Player1WasWere} able to use their hoofs to move them along the wall with the rope keeping them in place and after a swift swing they make it to the other end and throw the rope to the next Aries.

 
One by one the adventurers crossed over. But when ${Player2Name}  tried to swing across the gap, something went wrong and ${Player2HeSheThey} lost their grip. “Ahh!” ${cap(Player2HeSheThey)} screamed as ${Player2HeSheThey} plummeted down into the rocks below. 

“${Player2Name} !!” ${Player4Name} shouted as the Aries quickly picked themselves up and started hurrying down the path to find their fallen friend.

Thankfully ${Player2Name}  was found with merely a number of scratches and a bit of a limp. A sprained ankle, it seems. They got off easy, somehow. After a short rest and some mild first aid, ${Player3Name} was ready to go and the adventurers continued on their quest along a different path.

(${Player2Name}  takes 1 damage)




They choose to try the rope swinging method. With some finesse and a few tries, ${Player1Name} got the lasso of rope to tighten around a large sturdy rock that was jutting out from the top of the cliff face. 
${cap(Player1HeSheThey)} gave the rope a few strong tugs to test it’s hold and when ${Player1HeSheThey} ${Player1WasWere}  sure that it’s secure ${Player1HeSheThey} take the first swing over the gap. ${cap(Player1HeSheThey)} ${Player1WasWere} able to use their hoofs to move them along the wall with the rope keeping them in place and after a swift swing they make it to the other end and throw the rope to the next Aries.

One by one the adventurers crossed over. Thankfully they all made it across. They felt triumphant in their clever solution, and continued up the rocky path towards the spring.

`,
      next: [
        { label: "Fail",    url: "f" },
        { label: "Succeed", url: "g" }
      ]
    },
    {
      name:      "Turn Back",
      condition: "Always Available",
      prompt:    `${Player2Name} had an idea. "We could turn back, a ways down, to where that wall on the right started to form. We could try to climb that wall instead. It would take more time, and moving through the brush up there would be difficult, but it's surely safer than cracking our skulls like eggs on those rocks below."`,
      result:    `The Aries decided this is far too dangerous and they were not prepared to cross over the gap. They begrudgingly turned and walked back down the rock path in the other direction. They had to step carefully. Walking down hill on the loose stones was just as dangerous as the climb up - if not more so. ${Player4Name} slipped and tumbled down the hill but thankfully ${Player1Name} was able to grab ${Player4HimHerThem} in the nick of time to stop them from going over the edge. 


Eventually they reached the point in the trail where they were able to climb up the cliff on the side. This area was thick with brush and brambles, so the Aries moved carefully through the woods. They continued on.
`,
      next:      { label: "Continue", url: "f" }
    },
    {
      name:      "Use Shovel",
      condition: "Requires shovel",
      prompt:    `${Player4Name} was looking for a simpler approach and chimed in, "What if... what if we used a shovel? We could try to dig secure handholds into the cliff face on the right. Make it easier to climb across, step by step?"

${Player3Name} snorted. "Too slow, and still risky."`,
      result:    `50/50 result chance

The adventurers decide that if they had some deeper hoofholds on the side of the cliff, they’d be able to cross.

${Player2Name} took the shovel from their packs and started to carefully jab it into the side of the cliff, gouging out some solid hoofholds where they could secure themselves and sidle across the wall to the other end.

One by one the adventurers crossed over. Thankfully they all made it across. They felt triumphant in their clever solution, and continued up the rocky path towards the spring.



The adventurers decide that if they had some deeper hoofholds on the side of the cliff, they’d be able to cross.

${Player2Name} took the shovel from their packs and started to carefully jab it into the side of the cliff, gouging out some solid hoofholds where they can secure themselves and sidle across the wall to the other end.

One by one the adventurers crossed over. ${Player2Name} made it across but when ${Player3Name} tried to move across the rocks, something went wrong and ${Player3HeSheThey} lost their footing. “Ahh!” They screamed as they plummeted down into the rocks below. 

“${Player3Name}!!” ${Player4Name} shouted as the Aries quickly picked themselves up and started hurrying down the path to find their fallen friend.

Thankfully ${Player3Name} was found with merely a number of scratches and a bit of a limp. A sprained ankle, it seems. They got off easy, somehow. After a short rest and some mild first aid, ${Player3Name} was ready to go and the adventurers continued on their quest along a different path.

(${Player3Name} takes 1 damage)`,
      next: [
        { label: "Fail",    url: "f" },
        { label: "Succeed", url: "g" }
      ]
    },
    {
      name:      "Nature Spell",
      condition: "Requires mage with nature spell and the mana to cast it",
      prompt:    `**MAGE** grinned. "Or," they suggested, holding out their  **staff/wand**, a faint glimmer of green light emanating from it. "We could simply use a little Nature Magic. Create some stones, fill that gap right in, and walk across like it was never gone!"

“You can do that?!” ${Player2Name} asks, impressed.

(if player ${Player2Name} is the mage, sub for someone else)`,
      result:    `The party decided to allow **MAGE** to try their magic to make stepping stones to pass over the gap. They lifted up their **staff/wand** and the others stood back watching eagerly. As **MAGE** spoke their incantation the ground and rocks around them started to vibrate and shift. Manipulated by the nature magic, the rocks moved in front of **MAGE** and formed together like puzzle pieces, covering the break in the path. 

When the magic was over and **MAGE** finished the spell, the rocks fully filled in the way forward.

“Is it safe?” ${Player4Name} cautiously tapped at the magically placed rock with their hoof but it didn't shift or groan. The path seemed solid.

One by one, the Aries carefully crossed over the rock path and it held as if it was fortified with clay and stone. They congratulated **MAGE** on their talent as they continued into the forest towards the spring.

(if  ${Player4Name} is the mage, sub for someone else)`,
      next:      { label: "Continue", url: "f" }
    }
  ];

  const grid     = document.getElementById("optionGrid");
  const resBox   = document.getElementById("resultBox");
  const resTitle = document.getElementById("resultTitle");
  const resText  = document.getElementById("resultText");
  const resAct   = document.getElementById("resultActions");

  actions.forEach((act, idx) => {
    const box = document.createElement("div");
    box.className = "option-box";
    box.innerHTML = `
      <h3>${act.name}</h3>
	<hr>
      <p><strong>Condition:</strong> ${act.condition}</p>
      <p>${act.prompt}</p>
      <div class="button-group">
        <button class="storyButton" onclick="showResult(${idx})">Proceed</button>
        <button class="storyButton" onclick="copyPrompt(${idx})">Copy Prompt</button>
      </div>
    `;
    grid.appendChild(box);
  });

  function showResult(idx) {
    const act = actions[idx];
    resTitle.innerText = `Result: ${act.name}`;
    resText.innerText  = act.result;
    resAct.innerHTML   = "";

    const nexts = Array.isArray(act.next) ? act.next : [act.next];
    nexts.forEach(({label, url}) => {
      const btn = document.createElement("button");
      btn.className = "storyButton";
      btn.innerText = label;
      btn.onclick   = () => goToPage(url);
      resAct.appendChild(btn);
    });

    const copyBtn = document.createElement("button");
    copyBtn.className = "storyButton";
    copyBtn.innerText = "Copy Result";
    copyBtn.onclick   = copyResult;
    resAct.appendChild(copyBtn);

    resBox.style.display = "block";
  }

  function copyPrompt(idx) {
    navigator.clipboard.writeText(actions[idx].prompt)
      .then(() => alert("Prompt copied!"))
      .catch(() => alert("Copy failed."));
  }

  function copyResult() {
    navigator.clipboard.writeText(resText.innerText)
      .then(() => alert("Result copied!"))
      .catch(() => alert("Copy failed."));
  }

  const title = "Tainted Spring: Path Rocks";
  document.getElementById("pageTitle").innerText   = title;
  document.getElementById("promptTitle").innerText = title;

  function goToFix()    { window.location.href = `fix.html?${params}`; }
  function goToPage(pg){ window.location.href = `${pg}.html?${params}`; }

  // copy full story text
  function copyStory(){
    navigator.clipboard.writeText(storyText)
      .then(() => alert("Story copied!"))
      .catch(() => alert("Copy failed."));
  }
</script>

</body>
</html>

