<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title id="pageTitle">Multiplayer Prompt</title>
  <link rel="stylesheet" href="../../style.css">
  <style>
/* container and segment sizing */
.story {
  max-width: 1000px;
  margin: 0 auto;
}

.story-segment {
  background: #676767;            /* match your dark box look if needed */
  color: #eee;
  border-radius: 6px;
  padding: 1rem;
  margin: 0.75rem 0;
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
}

/* preserve newlines but allow wrapping so lines don't grow horizontally */
.story-segment pre {
  white-space: pre-wrap;      /* preserves newlines and allows wrapping */
  word-break: break-word;
  margin: 0;
  font-family: serif;         /* match your aesthetic from template */
  line-height: 1.4;
  max-height: 240px;          /* limit visible height */
  overflow: auto;             /* enable internal scrolling if needed */
  padding-right: 0.25rem;     /* room for scrollbar */
}

/* keep the copy button sized and aligned */
.story-segment .storyButton {
  align-self: flex-end;
  padding: 0.35rem 0.8rem;
  font-size: 0.95rem;
  border-radius: 6px;
  width: auto;
  min-width: 72px;
background-color: #303030;
}


    .button-group {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: auto;
    }
    #copyBuffer {
      position: absolute;
      left: -9999px;
    }
    .option-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-top: 30px;
    }
    .option-box {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: #676767;
      border: 2px solid #303030;
      border-radius: 8px;
      padding: 15px;
      text-align: left;
      min-height: 280px;
    }
    .option-box h3 {
      margin-top: 0;
      color: #ffffff;
    }
    .option-box p {
      margin: 8px 0;
    }
    .result-box {
      display: none;
      margin-top: 30px;
      background: #676767;
      border: 2px solid #303030;
      border-radius: 8px;
      padding: 20px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }
    .result-box h3 {
      margin-top: 0;
      color: #ffffff;
    }
    #resultActions {
      margin: 15px 0;
    }
	button{
		color: white;
}
.option-grid{
	background-color: #303030;
	padding: 20px;
}
.option-box button{
	background-color: #303030;
}

/* container: place buttons side-by-side */
.button-group, #resultActions{
  display: flex;
  gap: 10px;
  align-items: stretch; /* ensure children fill cross axis */
}

/* make every button share space and have identical height */
.button-group .storyButton, #resultActions button{
  flex: 1 1 0;         /* grow and shrink equally, no base width bias */
  min-width: 0;        /* allow proper shrinking inside grid */
  box-sizing: border-box;
  height: 48px;        /* fixed height so all match exactly */
  padding: 0 1rem;     /* horizontal padding only (vertical controlled by height) */
  display: inline-flex;
  align-items: center; /* center label vertically */
  justify-content: center;
  border-radius: 8px;
background-color: #303030;
}

.option-box hr{
  border: none;
  height: 1px;
  background: #ccc;        /* line color */
  margin: 0;          /* spacing */
  display: block;  
}

  </style>
</head>
<body class="prompt">
<article>
<div class="container">

<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">
  <div>
  <h2 id="promptTitle"></h2>
  <p>By Tenshilove</p>
</div>
<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">

</div>

<hr>

  <div id="customDisplay"></div>
  <button class="storyButton" onclick="goToFix()">Fix Parameters</button>
  <button class="storyButton" onclick="goToPage('index')">To Index</button>

  <div class="story">
    <div id="storyBox"></div>
    <button class="storyButton" onclick="copyStory()">Copy Story</button>
  </div>

  <div class="option-grid" id="optionGrid"></div>

  <div class="result-box" id="resultBox">
    <h3 id="resultTitle"></h3>
    <p id="resultText"></p>
    <div id="resultActions"></div>
  </div>

  <textarea id="copyBuffer"></textarea>
</article>

<script>
  // 0) pull URL params
  const params = new URLSearchParams(window.location.search);

  // 1) simple casing helpers
  const lc  = s => (s||"").toLowerCase();
  const cap = s => (s||"")[0]?.toUpperCase() + (s||"").slice(1);

  // 2) pronounSet → flat keys your template expects
  function pronounSet(subj) {
    subj = lc(subj);
    switch (subj) {
      case "she":  return { HeSheThey:"she", HimHerThem:"her", HisHerTheir:"her", HisHersTheirs:"hers", WasWere:"was", DoesDo:"does", HasHave:"has" };
      case "he":   return { HeSheThey:"he",  HimHerThem:"him",  HisHerTheir:"his",  HisHersTheirs:"his", WasWere:"was",  DoesDo:"does", HasHave:"has" };
      case "they": return { HeSheThey:"they",HimHerThem:"them",HisHerTheir:"their",HisHersTheirs:"theirs",WasWere:"were", DoesDo:"do",  HasHave:"have" };
      default:     return { HeSheThey:"it",  HimHerThem:"it",   HisHerTheir:"its", HisHersTheirs:"its", WasWere:"was",  DoesDo:"does", HasHave:"has" };
    }
  }

  // 3) ensure we got all params
  const required = [];
  for (let i = 1; i <= 4; i++) {
    required.push(
      `Player${i}Name`,
      `Player${i}HeSheThey`,
      `Player${i}Class`,
      `Player${i}Weapon`,
      `Player${i}Damage`
    );
  }
  if (required.some(k => !params.get(k))) {
    window.location.href = `fix.html?${params}`;
  }

  // 4) define real globals for Player1…Player4
  const players = [];
  for (let i = 1; i <= 4; i++) {
    const rawName  = params.get(`Player${i}Name`)    || "";
    const rawPron  = params.get(`Player${i}HeSheThey`)|| "";
    const rawClass = params.get(`Player${i}Class`)   || "";
    const rawWeap  = params.get(`Player${i}Weapon`)  || "";
    const rawDmg   = params.get(`Player${i}Damage`)  || "";

    const Name      = cap(lc(rawName));
    const HeSheThey = lc(rawPron);
    const Class     = cap(lc(rawClass));
    const Weapon    = cap(lc(rawWeap));
    const Damage    = lc(rawDmg);

    const pfx = pronounSet(HeSheThey);

    // expose as globals
    window[`Player${i}Name`]          = Name;
    window[`Player${i}HeSheThey`]     = pfx.HeSheThey;
    window[`Player${i}HimHerThem`]    = pfx.HimHerThem;
    window[`Player${i}HisHerTheir`]   = pfx.HisHerTheir;
    window[`Player${i}HisHersTheirs`] = pfx.HisHersTheirs;
    window[`Player${i}WasWere`]       = pfx.WasWere;
    window[`Player${i}DoesDo`]        = pfx.DoesDo;
    window[`Player${i}HasHave`]       = pfx.HasHave;
    window[`Player${i}Class`]         = Class;
    window[`Player${i}Weapon`]        = Weapon;
    window[`Player${i}Damage`]        = Damage;

    // also collect into players[] for the top display
    players.push({Name, HeSheThey, Class, Weapon, Damage});
  }

  // 5) render the top summary
  document.getElementById("customDisplay").innerHTML =
    players.map((p, i) =>
      `<strong>Player ${i+1}:</strong> ${p.Name} — 
       <em>${p.HeSheThey}</em> | Class: ${p.Class} | Weapon: ${p.Weapon} | Damage: ${p.Damage}`
    ).join("<br>");

  // --- NEW: storyText with delimiter and per-segment copy buttons ---
  const storyText = `The adventurers pressed onward through the Sage Forest. The air, usually crisp and clean, carried a faint, sour tang the deeper they ventured, a subtle reminder of the urgency of their quest.

"Keep your eyes peeled, everyone," ${Player1Name} murmured, ${Player1HisHerTheir} boots crunching softly on a carpet of fallen leaves. "The village elder said the taint draws strange creatures."

It was ${Player4Name} who spotted him first, not on the ground, but nestled precariously high in the boughs of a grand oak. "Hold on, what in the...?" 
${Player4HeSheThey} began, pointing a finger upwards. There, perched amidst a cluster of thick branches, was a foal. He looked no older than eight or nine, with a wild mop of shaggy blonde hair that seemed to defy gravity, and, a gleaming, pearlescent unicorn’s horn spiraling from his forehead. He was kicking his legs idly, humming a tuneless little song.

${Player3Name} stepped forward, craning ${Player3HisHerTheir} neck. "Well, hello there, little fellow. What are you doing all the way up here in the middle of the forest?"

The boy stopped humming, his bright, mischievous eyes locking onto the group. He grinned, a wide, challenging smirk that seemed too old for his young face. "What's it look like, noodle-brain? I'm playing!" With a flick of his wrist, he plucked an acorn from a nearby branch and accurately pinged it off ${Player3Name}’s shoulder. "Now go away. You’re scaring the squirrels."

${Player2Name} sighed, rubbing their temple. "Are you stuck up there, kid?" 
${Player2HeSheThey} asked, though the way he was carefully shifting his weight suggested he was indeed trying to find a footing to descend, only to hesitate.

"Stuck? Me? Nah!" he scoffed, puffing out his chest. "I just like the view from up here. It's much better than looking at boring old adventurers." It was clear, however, from the subtle clench of his small hands around the branch and the careful way he avoided putting full weight on his left leg, that he was more than a little held captive by his arboreal perch.

${Player1Name} groaned. "Look, kid, this isn't a playground. It's dangerous to be out here alone, especially this deep in the forest. You could get hurt, or worse, a monster could find you."

The boy rolled his eyes with dramatic flair. "Monsters? Pfft. They're all scared of me! And I'm never going home anyway, so there!" He stuck out his tongue, blowing a raspberry in their general direction, a defiant little sprite.

The adventurers exchanged weary glances. Before them lay a quest of grave importance, and now, a belligerent, unicorn foal stuck in a tree was causing them to linger.

 "We should just leave the stupid brat," ${Player3Name} grumbled, crossing ${Player3HisHerTheir} arms. "He said he's not stuck, let him have his way."

"We can't," ${Player2Name} immediately countered, ${Player2HisHerTheir} voice firm. "He might actually die if we leave him up here. What if a real monster does come? Or he falls? His leg looks a bit off."`.trim();

  // split into segments and render them with copy buttons
  const delimiter = "←—------------------- copy break—----------------->";
  const segments  = storyText.split(delimiter);
  const storyBox  = document.getElementById("storyBox");

  storyBox.innerHTML = ""; // clear

  segments.forEach((text) => {
    const trimmed = text.trim();
    if (!trimmed) return;

    const wrapper = document.createElement("div");
    wrapper.className = "story-segment";

    const pre = document.createElement("pre");
    pre.textContent = trimmed;

    const btn = document.createElement("button");
    btn.type = "button";
    btn.textContent = "Copy";
    btn.className = "storyButton";
    btn.addEventListener("click", () => {
      navigator.clipboard.writeText(trimmed)
        .then(() => {
          btn.textContent = "Copied!";
          setTimeout(() => btn.textContent = "Copy", 1200);
        })
        .catch(() => {
          btn.textContent = "Copy failed";
          setTimeout(() => btn.textContent = "Copy", 1200);
        });
    });

    wrapper.append(pre, btn);
    storyBox.appendChild(wrapper);
  });

  // 7) actions & UI (unchanged from your template2)
  const actions = [
    {
      name:      "Use Rope",
      condition: "Requires Item: Rope",
      prompt:    ` "We could use a rope," ${Player1Name} suggested, already rummaging through ${Player1HisHerTheir} pack. "A simple loop, and we could guide him down."`,
      result:    `"Hey kid! You need to come down from there, it's getting dark!" ${Player2Name} called up, trying to sound firm but friendly. The foal merely stuck out his tongue and blew a raspberry. 

"Fine, have it your way," ${Player1Name} grumbled, pulling out a rope. They lassoed a sturdy branch near the child, the rope whipping around it with a soft thwack. 

"Grab onto this, you little rascal!" ${Player3Name} shouted. Grudgingly, the child used the rope to climb down, landing lightly on the forest floor.

 But as ${Player4Name} knelt to speak with him, the child suddenly kicked them hard in the shin, letting out a sharp "Booger-head!" before hobbling off into the trees, favoring one leg. The adventurers winced, feeling a mix of frustration and a pang of worry as the child disappeared, angry but hopefully safe from the impending darkness. `,
      next:      { label: "Continue", url: "q" }
    },
    {
      name:      "Use Nature Magic",
      condition: "A mage with a nature spell and the mana in which to use it",
      prompt:    `MAGE stroked THEIR chin thoughtfully. "Or I could use some nature magic. I could coax some sturdy vines to grow up to him, a natural ladder for him to climb down safely."
`,
      result:    ` "Little one, it's not safe to be up there," ${Player3Name} pleaded, looking up at the impudent child. The unicorn simply crossed his arms, a smug look on his face. 

"This isn't getting us anywhere," ${Player2Name} sighed, stepping forward. 

"Let me try." MAGE recited the spell and then focused THEIR nature magic, and thick, leafy vines began to sprout and intertwine up the side of the tree, forming an easy ladder. 

"There, see? A nice, easy way down," ${Player1Name} offered gently. The child hesitantly climbed down the vines.

 When ${Player3Name} knelt down to check on him, the kid sneered, "You're stupid-heads!" He then quickly bent down, scooped up an acorn, and threw it with surprising force, hitting ${Player3Name} squarely on the forehead before darting off into the woods, favoring one leg as he ran. 
`,
      next:      { label: "Continue", url: "q" }
    },
    {
      name:      "Feed Him",
      condition: "Requires item: Rations",
      prompt:    `"He's clearly not going to cooperate with any of that," ${Player4Name} interjected, eyeing the boy who was now pelting them with more acorns and sneering. "Maybe we could lure him down with food? Do we have any dried berries or jerky left?"
`,
      result:    `"Are you hungry up there, little one?" ${Player1Name} called out, hoping to appeal to the child's basic needs. 

"NO!" the satyr child shouted back, but almost immediately, a loud rumble echoed from his stomach, making the adventurers exchange amused glances. 

"Well, it sounds like someone could use a snack," ${Player4Name} chuckled, pulling out a piece of jerky. "We'll help you down and give you this if you promise to go straight home." 

The kid shook his head stubbornly. So, ${Player2Name} took a bite of the jerky, chewing loudly and making appreciative noises. The foal watched them with wide, hungry eyes for a moment longer before reluctantly scrambling down. 

They shared the food, enduring the child's sullen mood and incessant "butthead" comments. Eventually, with a full stomach, he stomped off into the forest, clearly favoring one leg.`,
      next:      { label: "Continue", url: "q" }
    },
    {
      name:      "Heal Him",
      condition: "Requires item: Medkit",
      prompt:    `${Player1Name} peered up at the child again. "He does look a bit pale, and he's favoring that leg. Maybe he's actually hurt. We should get him down and use a medkit on him."`,
      result:    `"Hey, we have a medkit. Let us help you with that leg, okay?" ${Player2Name} called up to him. 

 The foal eyed them suspiciously, but the pain in his leg must have swayed him, as he reluctantly agreed. 

They carefully helped him down. As ${Player3Name} gently began to examine and patch up what appeared to be a sprained ankle, ${Player4Name} asked, "How did you get hurt, little guy?" 
 
The child puffed out his chest. "I was fighting against an angry Ogre!" The adventurers exchanged doubtful glances, but wisely kept their thoughts to themselves. Once the ankle was wrapped and supported, the child was able to stand on it more easily and, with a grumble, headed off toward home. `,
      next:      { label: "Continue", url: "q" }
    },
    {
      name:      "Heal Him",
      condition: "A healer with mana in which to heal",
      prompt:    `"Or I could try a minor healing spell," HEALER offered, tapping THEIR chin. "Just something to ease discomfort, if he truly is injured."`,
      result:    `"Look at his leg," ${Player3Name} pointed out, noticing the way the foal winced when he shifted his weight. "He looks hurt, and that’s why he won't come down." 

${Player4Name} called up, "We can help heal that leg with magic, if you'll let us!" 

The child stared down at them, a mixture of suspicion and curiosity on his face. After a moment, a small nod indicated his reluctant acceptance. Once he was carefully brought down from the tree, HEALER knelt beside him and placed a gentle hand over the injured ankle, murmuring a soft healing incantation. A warm glow emanated from THEIR hands, and the child's wince faded. 

"How did it happen?" ${Player1Name} asked. 

"I was fighting a really, really ogre troll!" the child declared proudly. The adventurers doubted the tale but simply nodded, and with his leg feeling much better, the child was able to walk away towards home, no longer favoring his ankle.`,
      next:      { label: "Continue", url: "q" }
    },
    {
      name:      "Leave him be",
      condition: "Always Available",
      prompt:    `${Player3Name} sighed, looking at the setting sun filtering through the leaves. "We can't waste time trying to bring the kid home. Our priority is the spring."

"But if we leave him, it sits heavy on the conscience," ${Player2Name} conceded, a flicker of concern in ${Player2HisHerTheir} eyes despite ${Player2HisHerTheir}. "Hey, kid! Do you at least know the way home, if you want to go?"

The boy looked down, his lips pressed into a thin line. "Wouldn't tell you if I did! And I don't want to go!"
`,
      result:    `The adventurers debated with the stubborn satyr child for several minutes, growing increasingly frustrated with his refusal to cooperate. 

"Look, we don't have all day!" ${Player1Name} finally exclaimed, throwing ${Player1HisHerTheir} hands up. "You can stay up there if you want!" 

The child, still perched defiantly on his branch, stuck out his tongue, called them "Stupid face!" and started pelting them with acorns. 

"Well, that's mature," ${Player2Name} muttered, dodging a particularly large one. 

"Is it really okay to leave him?" ${Player3Name} asked, a flicker of doubt in their eyes. 

"He'll get cold eventually and go home," ${Player4Name} reasoned, rubbing ${Player4HisHerTheir} head where an acorn had landed. "Besides, we'll tell the townsfolk where he is. We have a quest to finish." With a final glance at the still-insulting child, they turned and continued on their way. `,
      next:      { label: "Continue", url: "q" }
    },
    {
      name:      "Bring him",
      condition: "Always Available",
      prompt:    `${Player1Name} threw ${Player1HisHerTheir} hands up in exasperation. "Well, that settles it then. It seems we'll have to bring him along, at least until we can find someone responsible for him. Looks like our quest just got a whole lot noisier." The other adventurers groaned in unison, but a resigned determination settled over them.  `,
      result:    `"This is ridiculous; we can't just leave him here," ${Player1Name} decided, exasperated but firm. 

"It's too dangerous." ${Player2Name} nodded in agreement. "I'll go get him." With determination, ${Player2Name} began to climb the tree, agilely moving up the sturdy branches despite the child's protests. The foal child kicked and squirmed as ${Player2Name} reached him, trying to push them away.

 "Stupid! Leave me alone!" he shrieked, landing a solid kick on ${Player2Name}'s shin as they wrestled him down to the ground. 

Grimacing, ${Player3Name} knelt down, trying to get on the child's level. "We're going to fix the spring water, and we might even fight some crazy monsters along the way," ${Player3HeSheThey} offered, improvising. "Do you want to come with us? We'll bring you home afterwards." 

Aside, the adventurers briefly debated the wisdom of bringing a child into danger, but decided it was more dangerous to leave him alone in the increasingly dark forest. The promise of monsters and adventure, however, had piqued the child's interest, and after a moment of consideration, he agreed to come along, his previous defiance replaced by eager curiosity. 
`,
      next:      { label: "Continue", url: "q" }
    }
  ];

  const grid     = document.getElementById("optionGrid");
  const resBox   = document.getElementById("resultBox");
  const resTitle = document.getElementById("resultTitle");
  const resText  = document.getElementById("resultText");
  const resAct   = document.getElementById("resultActions");

  actions.forEach((act, idx) => {
    const box = document.createElement("div");
    box.className = "option-box";
    box.innerHTML = `
      <h3>${act.name}</h3>
	<hr>
      <p><strong>Condition:</strong> ${act.condition}</p>
      <p>${act.prompt}</p>
      <div class="button-group">
        <button class="storyButton" onclick="showResult(${idx})">Proceed</button>
        <button class="storyButton" onclick="copyPrompt(${idx})">Copy Prompt</button>
      </div>
    `;
    grid.appendChild(box);
  });

  function showResult(idx) {
    const act = actions[idx];
    resTitle.innerText = `Result: ${act.name}`;
    resText.innerText  = act.result;
    resAct.innerHTML   = "";

    const nexts = Array.isArray(act.next) ? act.next : [act.next];
    nexts.forEach(({label, url}) => {
      const btn = document.createElement("button");
      btn.className = "storyButton";
      btn.innerText = label;
      btn.onclick   = () => goToPage(url);
      resAct.appendChild(btn);
    });

    const copyBtn = document.createElement("button");
    copyBtn.className = "storyButton";
    copyBtn.innerText = "Copy Result";
    copyBtn.onclick   = copyResult;
    resAct.appendChild(copyBtn);

    resBox.style.display = "block";
  }

  function copyPrompt(idx) {
    navigator.clipboard.writeText(actions[idx].prompt)
      .then(() => alert("Prompt copied!"))
      .catch(() => alert("Copy failed."));
  }

  function copyResult() {
    navigator.clipboard.writeText(resText.innerText)
      .then(() => alert("Result copied!"))
      .catch(() => alert("Copy failed."));
  }

  const title = "Tainted Spring: Stubborn foal";
  document.getElementById("pageTitle").innerText   = title;
  document.getElementById("promptTitle").innerText = title;

  function goToFix()    { window.location.href = `fix.html?${params}`; }
  function goToPage(pg){ window.location.href = `${pg}.html?${params}`; }

  // copy full story text
  function copyStory(){
    navigator.clipboard.writeText(storyText)
      .then(() => alert("Story copied!"))
      .catch(() => alert("Copy failed."));
  }
</script>

</body>
</html>

