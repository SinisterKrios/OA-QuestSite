<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title id="pageTitle">Multiplayer Prompt</title>
  <link rel="stylesheet" href="../../style.css">
  <style>
/* container and segment sizing */
.story {
  max-width: 1000px;
  margin: 0 auto;
}

.story-segment {
  background: #676767;            /* match your dark box look if needed */
  color: #eee;
  border-radius: 6px;
  padding: 1rem;
  margin: 0.75rem 0;
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
}

/* preserve newlines but allow wrapping so lines don't grow horizontally */
.story-segment pre {
  white-space: pre-wrap;      /* preserves newlines and allows wrapping */
  word-break: break-word;
  margin: 0;
  font-family: serif;         /* match your aesthetic from template */
  line-height: 1.4;
  max-height: 240px;          /* limit visible height */
  overflow: auto;             /* enable internal scrolling if needed */
  padding-right: 0.25rem;     /* room for scrollbar */
}

/* keep the copy button sized and aligned */
.story-segment .storyButton {
  align-self: flex-end;
  padding: 0.35rem 0.8rem;
  font-size: 0.95rem;
  border-radius: 6px;
  width: auto;
  min-width: 72px;
background-color: #303030;
}


    .button-group {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: auto;
    }
    #copyBuffer {
      position: absolute;
      left: -9999px;
    }
    .option-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-top: 30px;
    }
    .option-box {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: #676767;
      border: 2px solid #303030;
      border-radius: 8px;
      padding: 15px;
      text-align: left;
      min-height: 280px;
    }
    .option-box h3 {
      margin-top: 0;
      color: #ffffff;
    }
    .option-box p {
      margin: 8px 0;
    }
    .result-box {
      display: none;
      margin-top: 30px;
      background: #676767;
      border: 2px solid #303030;
      border-radius: 8px;
      padding: 20px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }
    .result-box h3 {
      margin-top: 0;
      color: #ffffff;
    }
    #resultActions {
      margin: 15px 0;
    }
	button{
		color: white;
}
.option-grid{
	background-color: #303030;
	padding: 20px;
}
.option-box button{
	background-color: #303030;
}

/* container: place buttons side-by-side */
.button-group, #resultActions{
  display: flex;
  gap: 10px;
  align-items: stretch; /* ensure children fill cross axis */
}

/* make every button share space and have identical height */
.button-group .storyButton, #resultActions button{
  flex: 1 1 0;         /* grow and shrink equally, no base width bias */
  min-width: 0;        /* allow proper shrinking inside grid */
  box-sizing: border-box;
  height: 48px;        /* fixed height so all match exactly */
  padding: 0 1rem;     /* horizontal padding only (vertical controlled by height) */
  display: inline-flex;
  align-items: center; /* center label vertically */
  justify-content: center;
  border-radius: 8px;
background-color: #303030;
}

.option-box hr{
  border: none;
  height: 1px;
  background: #ccc;        /* line color */
  margin: 0;          /* spacing */
  display: block;  
}

  </style>
</head>
<body class="prompt">
<article>
<div class="container">

<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">
  <div>
  <h2 id="promptTitle"></h2>
  <p>By Tenshilove</p>
</div>
<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">

</div>

<hr>

  <div id="customDisplay"></div>
  <button class="storyButton" onclick="goToFix()">Fix Parameters</button>
  <button class="storyButton" onclick="goToPage('index')">To Index</button>

  <div class="story">
    <div id="storyBox"></div>
    <button class="storyButton" onclick="copyStory()">Copy Story</button>
  </div>

  <div class="option-grid" id="optionGrid"></div>

  <div class="result-box" id="resultBox">
    <h3 id="resultTitle"></h3>
    <p id="resultText"></p>
    <div id="resultActions"></div>
  </div>

  <textarea id="copyBuffer"></textarea>
</article>

<script>
  // 0) pull URL params
  const params = new URLSearchParams(window.location.search);

  // 1) simple casing helpers
  const lc  = s => (s||"").toLowerCase();
  const cap = s => (s||"")[0]?.toUpperCase() + (s||"").slice(1);

  // 2) pronounSet → flat keys your template expects
  function pronounSet(subj) {
    subj = lc(subj);
    switch (subj) {
      case "she":  return { HeSheThey:"she", HimHerThem:"her", HisHerTheir:"her", HisHersTheirs:"hers", WasWere:"was", DoesDo:"does", HasHave:"has" };
      case "he":   return { HeSheThey:"he",  HimHerThem:"him",  HisHerTheir:"his",  HisHersTheirs:"his", WasWere:"was",  DoesDo:"does", HasHave:"has" };
      case "they": return { HeSheThey:"they",HimHerThem:"them",HisHerTheir:"their",HisHersTheirs:"theirs",WasWere:"were", DoesDo:"do",  HasHave:"have" };
      default:     return { HeSheThey:"it",  HimHerThem:"it",   HisHerTheir:"its", HisHersTheirs:"its", WasWere:"was",  DoesDo:"does", HasHave:"has" };
    }
  }

  // 3) ensure we got all params
  const required = [];
  for (let i = 1; i <= 4; i++) {
    required.push(
      `Player${i}Name`,
      `Player${i}HeSheThey`,
      `Player${i}Class`,
      `Player${i}Weapon`,
      `Player${i}Damage`
    );
  }
  if (required.some(k => !params.get(k))) {
    window.location.href = `fix.html?${params}`;
  }

  // 4) define real globals for Player1…Player4
  const players = [];
  for (let i = 1; i <= 4; i++) {
    const rawName  = params.get(`Player${i}Name`)    || "";
    const rawPron  = params.get(`Player${i}HeSheThey`)|| "";
    const rawClass = params.get(`Player${i}Class`)   || "";
    const rawWeap  = params.get(`Player${i}Weapon`)  || "";
    const rawDmg   = params.get(`Player${i}Damage`)  || "";

    const Name      = cap(lc(rawName));
    const HeSheThey = lc(rawPron);
    const Class     = cap(lc(rawClass));
    const Weapon    = cap(lc(rawWeap));
    const Damage    = lc(rawDmg);

    const pfx = pronounSet(HeSheThey);

    // expose as globals
    window[`Player${i}Name`]          = Name;
    window[`Player${i}HeSheThey`]     = pfx.HeSheThey;
    window[`Player${i}HimHerThem`]    = pfx.HimHerThem;
    window[`Player${i}HisHerTheir`]   = pfx.HisHerTheir;
    window[`Player${i}HisHersTheirs`] = pfx.HisHersTheirs;
    window[`Player${i}WasWere`]       = pfx.WasWere;
    window[`Player${i}DoesDo`]        = pfx.DoesDo;
    window[`Player${i}HasHave`]       = pfx.HasHave;
    window[`Player${i}Class`]         = Class;
    window[`Player${i}Weapon`]        = Weapon;
    window[`Player${i}Damage`]        = Damage;

    // also collect into players[] for the top display
    players.push({Name, HeSheThey, Class, Weapon, Damage});
  }

  // 5) render the top summary
  document.getElementById("customDisplay").innerHTML =
    players.map((p, i) =>
      `<strong>Player ${i+1}:</strong> ${p.Name} — 
       <em>${p.HeSheThey}</em> | Class: ${p.Class} | Weapon: ${p.Weapon} | Damage: ${p.Damage}`
    ).join("<br>");

  // --- NEW: storyText with delimiter and per-segment copy buttons ---
  const storyText = `The air in the Sage Forest grew thick with the scent of blossoms and something else, something wonderfully sweet and rich. As our adventurers journeyed deeper, the hum of countless wings became audible, growing louder until they found themselves in a clearing alive with activity. Bees, in their industrious thousands, buzzed around an array of flowering plants and, more prominently, a series of large, golden hives nestled high in the ancient trees. The aroma of honey wafted towards them, a potent, irresistible perfume.

"Oh, by the wilds, that smells incredible!" ${Player3Name} exclaimed, ${Player3HisHerTheir} eyes widening with delight. "Like a perfect summer's day and a baker's dream all rolled into one."

${Player2Name} let out a wistful sigh. "You know, that smell reminds me of the honey buns I used to get from that little stall in Oak Hollow. And those honey cookies… pure heaven. And don't even get me started on the honey tea. The sweet, floral notes…"

"${Player2Name}, please, you're making us all so hungry!" ${Player1Name} interjected with a chuckle, though ${Player1HisHerTheir} own stomach rumbled in agreement. "My mouth is watering just thinking about it. We're on a quest to save a village’s water, not to raid a beehive."

${Player4Name} grinned. "Though, if this quest goes on much longer, a good honey bun might be just what we need for energy. Imagine, a whole barrel of this stuff!"

Their lighthearted banter filled the air, a welcome contrast to the seriousness of their mission. The very thought of the villagers suffering from the corrupted water had spurred them onward, but even the most determined adventurers could appreciate a moment of levity, especially when accompanied by such a delightful aroma.

Lost in their shared daydreams of sweet treats, ${Player3Name}, still talking about the imagined textures and tastes of confectionery, took a step backward without looking. A muffled yelp, followed by a squelch, broke the pleasant reverie. ${Player3Name} had, with spectacular inelegant precision, planted ${Player3HisHerTheir} hoof directly into the base of a particularly large and overloaded beehive.

A torrent of sticky, golden honey cascaded down, coating ${Player3Name}’s legs and, to their horror, stuck with a tight grip to ${Player3HisHerTheir} fur. 
${cap(Player3HeSheThey)} stood frozen for a moment, a sticky, bewildered mess.

${Player4Name} burst out laughing. "${Player3Name}! You absolute klutz! You've gone and honey-dipped yourself!"

${Player1Name} snorted.


${Player2Name} snickered, clapping a hand over ${Player2HisHerTheir} mouth. "Looks like you're the new centerpiece of the honey festival, my friend!"


${Player3Name}, dripping and indignant, managed to splutter, "It’s not funny! This is… this is incredibly sticky!"

Their mirth, however, was short-lived. The sudden disturbance, the sticky intrusion, and the distressed vibrations from their hive had not gone unnoticed. The gentle hum of activity quickly escalated into an angry, menacing buzz. Thousands of bees, their tiny bodies bristling with indignation, detached themselves from their floral duties and their golden homes, swarming towards the source of their annoyance.

"Uh oh," ${Player1Name} said, their laughter vanishing instantly. "I think we've made some new enemies!"

The air filled with a furious, unified roar of angry bees. They descended upon the adventurers, a buzzing, stinging cloud of fury.

"RUN!" ${Player4Name} yelled, instinctively putting ${Player4HisHerTheir} hands up to shield ${Player4HisHerTheir}  face.

Panic erupted. The adventurers turned and fled, the swarm a relentless wave of fury at their heels. They scrambled through the undergrowth, their shouts of alarm mixing with the frantic buzz of their pursuers.

"We need a plan!" ${Player2Name} shouted, dodging a low-hanging branch. "Fighting them all is suicide!"

The suggestions flew back and forth, a desperate barrage of ideas born from adrenaline and the stinging threat of myriad tiny stings. The forest floor blurred beneath their hooves as they raced, the relentless hum of the bee swarm a constant, terrifying reminder of their precarious situation. 
`.trim();

  // split into segments and render them with copy buttons
  const delimiter = "←—------------------- copy break—----------------->";
  const segments  = storyText.split(delimiter);
  const storyBox  = document.getElementById("storyBox");

  storyBox.innerHTML = ""; // clear

  segments.forEach((text) => {
    const trimmed = text.trim();
    if (!trimmed) return;

    const wrapper = document.createElement("div");
    wrapper.className = "story-segment";

    const pre = document.createElement("pre");
    pre.textContent = trimmed;

    const btn = document.createElement("button");
    btn.type = "button";
    btn.textContent = "Copy";
    btn.className = "storyButton";
    btn.addEventListener("click", () => {
      navigator.clipboard.writeText(trimmed)
        .then(() => {
          btn.textContent = "Copied!";
          setTimeout(() => btn.textContent = "Copy", 1200);
        })
        .catch(() => {
          btn.textContent = "Copy failed";
          setTimeout(() => btn.textContent = "Copy", 1200);
        });
    });

    wrapper.append(pre, btn);
    storyBox.appendChild(wrapper);
  });

  // 7) actions & UI (unchanged from your template2)
  const actions = [
    {
      name:      "Set Fire with a Lantern",
      condition: "Requires Item: Lantern",
      prompt:    `"Maybe we can use fire?" ${Player3Name} panted, casting a desperate glance back at the swarm. "Do we have a lantern? We could try to set something alight to scare them!"
`,
      result:    ` "The lantern!" ${Player1Name} yelled, yanking it from ${Player1HisHerTheir} pack. "Use it!" ${Player1Name} lit the lantern and hurled it behind them. It shattered on the ground, and a large fire quickly ignited, its smoke billowing up and creating an impassable wall of smoke and flames. 

The bees, afraid of the smoke and fire, swirled angrily at the edge of the inferno before turning back. With a collective sigh of relief, the adventurers kept running until they were far away. 

"Do you think we should be worried about a forest fire?" ${Player2Name} asked nervously. 

"Nah, it'll probably be fine," ${Player4Name} said, trying to sound confident. "We had a quest to finish, and we did what we had to do."`,
      next:      { label: "Continue", url: "q" }
    },
    {
      name:      "Set Fire with Magic",
      condition: "A mage with a fire spell and the mana in which to cast it",
      prompt:    ` “They hate fire, right? What about a flaming spell?” MAGE leaps over a fallen log, not daring to look back.`,
      result:    `"I'll handle this!" ${Player2Name} shouted, as ${Player2HeSheThey} turned and conjured a burst of fire. 

The spell erupted behind them, creating a massive, blazing wall. The smoke billowed up and created an impassable wall of smoke and flames. The bees, sensing danger, turned back and disappeared into the smoke. 

The adventurers ran away, not stopping until they were far away and safe. "Do you think we should be worried about a forest fire?" ${Player1Name} asked nervously. 

"Nah, it'll probably be fine," ${Player4Name} said, wiping sweat from ${Player4HisHerTheir} brow. "The quest is more important, so we did what we had to do."

 They all continued on, not looking back.`,
      next:      { label: "Continue", url: "q" }
    },
    {
      name:      "Run to the Brooke",
      condition: "Always available",
      prompt:    ` "What about water?" ${Player2Name}, still sticky but moving with surprising speed, yelled over ${Player2HisHerTheir} shoulder. "I think I saw a stream not too far back! If we can get to it and dive in, maybe they’ll buzz off!"

"Good idea,  ${Player2Name}!" ${Player1Name} cried. "But can we reach it before they swarm us?"`,
      result:    `50/50 chance for results

"We have no other option! We have to run to the stream!" ${Player1Name} screamed, pointing ahead. The party sprinted forward, but the bees were faster.  

The adventurers were overwhelmed by the sheer number of bees, which angrily stung them on their faces, necks, and hands, even managing to get under their clothes. They danced around, swatting frantically at the insects in a desperate but futile attempt to fend them off. After what felt like an eternity, the swarm finally left them alone.  

 The adventurers, covered in painful welts, made it to the stream and sat down, their faces swollen and their bodies throbbing with pain. "See?" ${Player2Name} grumbled, splashing water on ${Player2HisHerTheir} face. "I told you it was too far. Now we're in pain and we're wet and we didn't even get to heal."


"The stream!" ${Player1Name} shouted, pointing ahead. "It's our only chance!" 

The adventurers ran as fast as their legs could carry them. They reached the stream with the bees right on their heels.

"Everyone in!" ${Player2Name} yelled, and they all dove in, holding their breath and hiding under the surface for what felt like an eternity. 

When they finally surfaced, gasping for air, the bees were gone. They swam to the shore, shivering and soaked, but safe. 

"That was... terrifying,"  ${Player3Name} said, shaking the water from ${Player3HisHerTheir} hair. "At least we weren't stung!" ${Player4Name} added, before they all continued on their quest, wet but unharmed.`,
      next: { label: "Continue", url: "q" }
    },
    {
      name:      "Splash Bees with Magic",
      condition: "A mage with a water spell and the mana in which to cast it",
      prompt:    `MAGE chimed in, THEIR brow furrowed in thought. "What about magic? I have water magic. I could drench them if we get cornered?"

${Player4Name} nodded grimly. "We could try, but it would take a lot of energy, and a lot of water. And if they're already this agitated, a dousing might just make them angrier."`,
      result:    `"I have an idea!" MAGE, yelled over the buzzing of the bees. They quickly conjured a huge wave of water and splashed it at the swarm. The bees, taken by surprise and soaked by the water, were dazed and confused. 

"Now's our chance!" ${Player1Name} shouted, and the group ran away, leaving the distracted bees behind them. "

That was a great idea,"  ${Player2Name} said, as they continued on their quest. "Now we just need to get far away from here."`,
      next:      { label: "Continue", url: "q" }
    },
    {
      name:      "Use Ration",
      condition: "Requires item: Ration",
      prompt:    `${Player3Name} added, "What if we sacrifice some of our rations? We have those dried fruits and jerky. If we throw them as a distraction, maybe the bees will swarm the food instead of us, and we can slip away!"
`,
      result:    `"What are we going to do!?"  ${Player2Name} screamed as the buzzing grew louder. 

"They're right behind us!" ${Player1Name}, thinking quickly, had an idea. "Sacrifice the food!" they shouted.

 "The food is more important than our lives, and we must do what we must do to save ourselves!"  ${Player3Name} said, tossing a large loaf of bread behind ${Player3HimHerThem}. 

The rest of the party quickly followed, throwing their rations of fruits, cheeses, and jerky into the air behind them. The bees, distracted by the sudden feast, swarmed the food, giving the adventurers just enough time to make their escape. 

"I'm going to regret that later," ${Player4Name} muttered, ${Player4HisHerTheir} stomach rumbling. "But at least we aren't covered in stings!" 

They continued on their quest, a little hungry but completely unharmed.`,
      next:      { label: "Continue", url: "q" }
    },
    {
      name:      "Get Stung",
      condition: "Requires mage with water spell",
      prompt:    `The thought of letting the bees sting them and then having to heal the inevitable wounds, a grim prospect in the best of times, felt like the worst of their options, a last resort none of them were eager to consider. Their quest for clean water had taken a decidedly sticky and stingy turn.`,
      result:    `The adventurers, caught off guard by the swarm, had panicked. Instead of acting, they argued about the best course of action. "We should run for the stream!" ${Player1Name} yelled. "No, we should use a fire spell!"  ${Player2Name} countered, but it was too late. 

The bees, enraged and fast, overtook them. The adventurers were overwhelmed by the sheer number of bees, which angrily stung them on their faces, necks, and hands, even managing to get under their clothes. They danced around, swatting frantically at the insects in a desperate but futile attempt to fend them off. After what felt like an eternity, the swarm finally left them alone. Bruised, swollen, and in pain, they collapsed in the flowery glen.

The adventurers were a sorry sight, their faces swollen and their bodies throbbing with pain. 

"I've never been stung so many times in my life," ${Player2Name} groaned, gently touching a large welt on ${Player2HisHerTheir} neck. 

"Well, that's what happens when we don't act quickly,"  ${Player3Name} said, though ${Player3HisHerTheir} voice was muffled by a swollen lip. Without a medkit or a healer's magic, there was nothing they could do but endure the painful stings. 

"Just... try not to move too much," ${Player4Name} said carefully, before they all slowly and painfully continued on their quest, every step a reminder of their mistake.
Players each take 1 dmg`,
      next:      { label: "Continue", url: "q" }
    }
  ];

  const grid     = document.getElementById("optionGrid");
  const resBox   = document.getElementById("resultBox");
  const resTitle = document.getElementById("resultTitle");
  const resText  = document.getElementById("resultText");
  const resAct   = document.getElementById("resultActions");

  actions.forEach((act, idx) => {
    const box = document.createElement("div");
    box.className = "option-box";
    box.innerHTML = `
      <h3>${act.name}</h3>
	<hr>
      <p><strong>Condition:</strong> ${act.condition}</p>
      <p>${act.prompt}</p>
      <div class="button-group">
        <button class="storyButton" onclick="showResult(${idx})">Proceed</button>
        <button class="storyButton" onclick="copyPrompt(${idx})">Copy Prompt</button>
      </div>
    `;
    grid.appendChild(box);
  });

  function showResult(idx) {
    const act = actions[idx];
    resTitle.innerText = `Result: ${act.name}`;
    resText.innerText  = act.result;
    resAct.innerHTML   = "";

    const nexts = Array.isArray(act.next) ? act.next : [act.next];
    nexts.forEach(({label, url}) => {
      const btn = document.createElement("button");
      btn.className = "storyButton";
      btn.innerText = label;
      btn.onclick   = () => goToPage(url);
      resAct.appendChild(btn);
    });

    const copyBtn = document.createElement("button");
    copyBtn.className = "storyButton";
    copyBtn.innerText = "Copy Result";
    copyBtn.onclick   = copyResult;
    resAct.appendChild(copyBtn);

    resBox.style.display = "block";
  }

  function copyPrompt(idx) {
    navigator.clipboard.writeText(actions[idx].prompt)
      .then(() => alert("Prompt copied!"))
      .catch(() => alert("Copy failed."));
  }

  function copyResult() {
    navigator.clipboard.writeText(resText.innerText)
      .then(() => alert("Result copied!"))
      .catch(() => alert("Copy failed."));
  }

  const title = "Tainted Spring: Honey Hives";
  document.getElementById("pageTitle").innerText   = title;
  document.getElementById("promptTitle").innerText = title;

  function goToFix()    { window.location.href = `fix.html?${params}`; }
  function goToPage(pg){ window.location.href = `${pg}.html?${params}`; }

  // copy full story text
  function copyStory(){
    navigator.clipboard.writeText(storyText)
      .then(() => alert("Story copied!"))
      .catch(() => alert("Copy failed."));
  }
</script>

</body>
</html>

