<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title id="pageTitle">Multiplayer Prompt</title>
<link rel="stylesheet" href="../../style.css">
  <style>
    .storyButton {
	width: 100%;
	color: white;
    }
    .storyButton:hover {
      background: #ffffff;
    }
    article {
      max-width: 1000px;
    }
button{
	width: 50%;
}
#conditionButtons {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

#conditionButtons button {
  padding: 0.5rem 1rem;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  gap: 1rem;
}

.narrative-box {
  background: #111;
  color: #eee;
  padding: 1rem;
  border-radius: 6px;
  font-family: serif;
  white-space: pre-wrap;
}



    #copyBuffer {
      position: absolute;
      left: -9999px;
    }

    /* HP Tracker as two boxes */
    #hpContainer {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin: 20px auto;
    }
    .hp-box {
      background: #676767;
      border: 2px solid #303030;
      border-radius: 8px;
      padding: 10px;
      width: 48%;
      text-align: right;
    }
    .hp-box h3 {
      color: white;
      margin-bottom: 12px;
	margin-top: 12px;
	text-align: center;
	font-size: 30px;
    }
    .hp-entry {
      display: flex;
      align-items: right;
      justify-content: space-between;
      margin-bottom: 8px;
  gap: 8px;

    }
    .hp-entry span {
      flex: 1;
	width: 100px;    
    }
    .hp-entry input[type="number"] {
      width: 50px;
      margin: 0px;
  	text-align: center;
	background: #a1a1a2;

    }
	.gray{
	margin: 0;
	padding
	background: #303030;
}
.hp-entry {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem 0;
  border-bottom: 1px solid #ccc;
}

.hp-left {
  flex: 1;
  font-weight: bold;
  padding-right: 1rem;
	text-align: left;
}

.hp-right {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.hp-right input[type="number"] {
  width: 4rem;
  text-align: center;
}

.dead-toggle {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  cursor: pointer;
}
.col {
  flex: 1;
width: 33%;
}
.col button{
width: 100%;
}
.continueButtons{
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  justify-content: center;
width: 100%;

}
.continueButtons button{
  flex: 1 1 200px; /* grow, shrink, base width */
  padding: 0.75rem 1rem;
  font-size: 1rem;
  font-weight: bold;
  text-align: center;
  }
.continueButtons a{
	display: inline-block;
	width: 40%;
}
#storyBox{
	background: #676767;
}
#conditionText{
	background: #303030;
}
#narrativeContent{
	background: #676767;
	padding: 10px;
}
button{
color: white;
}
#openNewTab{
width: 100%;
}

  </style>
</head>
<body>
<article>
<div class="container">

<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">
  <div>
  <h2 id="promptTitle">Your Prompt Title Here</h2>
  <p>By Tenshilove</p>
</div>
<img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/71515031-3f45-4117-abcd-a4fc1856b7d7/d6501sy-73956cdd-e523-4ac3-9b77-6d2c6ca2bab7.gif">

</div>

<hr>

  <div id="customDisplay"></div>
  <button class="storyButton" onclick="goToFix()">Fix Parameters</button>
  <button class="storyButton" onclick="goToPage('index')">To Index</button>

  <div class="story">
    <div id="storyBox"></div>
	<BR>
    <button class="storyButton" onclick="copyStory()">Copy Story</button>
  </div>

<button id="openNewTab">Open Outcome Page</button>

<hr>


<h1>HP Tracker</h1>

  <!-- HP Tracker: two boxes side-by-side -->
  <div id="hpContainer">
    <div class="hp-box" id="partyBox">
	<div class="gray">
      <h3>Party</h3>
<hr>
	</div>
      <div id="partyRows"></div>
    </div>
    <div class="hp-box" id="enemyBox">
	<div class="gray">
      <h3>Enemy</h3>
<hr>
	</div>
      <div id="enemyRows"></div>
    </div>
  </div>

  <textarea id="copyBuffer"></textarea>

<div id="conditionButtons">
<div class="col">
  <button data-key="partyVictory">Full Party Victory</button>
  <button data-key="manDownFlee">Man Down Flee</button>
</div>

<div class="col">
  <button data-key="manDownVictory">Man Down Victory</button>
  <button data-key="partyFlee">Full Party Flee</button>
</div>

<div class="col">
  <button data-key="partyKill">Total Party Kill</button>
  <button data-key="fleeBeforeBattle">Flee Before Battle</button>
</div>
</div>

<div id="conditionText" class="narrative-box">
  <div id="narrativeContent"></div>
  <button id="copyNarrative">Copy Text</button>
</div>
<br>
<div class="continueButtons">
  <button data-href="x.html">Successful Flee</button>
  <button data-href="y.html">Full Party Victory</button>
</div>


</article>

<script>
  // 0) params & helpers
  const params = new URLSearchParams(window.location.search);
  const lc  = s => (s||"").toLowerCase();
  const cap = s => (s||"")[0]?.toUpperCase() + (s||"").slice(1);

  // pronouns (unchanged)
  function pronounSet(subj) {
    subj = lc(subj);
    if (subj==="she")  return {HeSheThey:"she", HimHerThem:"her", HisHerTheir:"her", HisHersTheirs:"hers", WasWere:"was", DoesDo:"does", HasHave:"has"};
    if (subj==="he")   return {HeSheThey:"he", HimHerThem:"him", HisHerTheir:"his", HisHersTheirs:"his", WasWere:"was", DoesDo:"does", HasHave:"has"};
    if (subj==="they") return {HeSheThey:"they", HimHerThem:"them", HisHerTheir:"their", HisHersTheirs:"theirs", WasWere:"were", DoesDo:"do",  HasHave:"have"};
    return           {HeSheThey:"it", HimHerThem:"it",  HisHerTheir:"its", HisHersTheirs:"its", WasWere:"was", DoesDo:"does", HasHave:"has"};
  }

  // ensure required params
  const required = [];
  for (let i=1; i<=4; i++) {
    ["Name","HeSheThey","Class","Weapon","Damage"]
      .forEach(f => required.push(`Player${i}${f}`));
  }
  if (required.some(k => !params.get(k))) {
    window.location.href = `fix.html?${params}`;
  }

  // 4) define globals for Player1…Player4 and build players[]
  const players = [];
  for (let i = 1; i <= 4; i++) {
    const rawName  = params.get(`Player${i}Name`)     || "";
    const rawPron  = params.get(`Player${i}HeSheThey`)|| "";
    const rawClass = params.get(`Player${i}Class`)    || "";
    const rawWeap  = params.get(`Player${i}Weapon`)   || "";
    const rawDmg   = params.get(`Player${i}Damage`)   || "";

    const Name      = cap(lc(rawName));
    const HeSheThey = lc(rawPron);
    const Class     = cap(lc(rawClass));
    const Weapon    = cap(lc(rawWeap));
    const Damage    = lc(rawDmg);

    const pfx       = pronounSet(HeSheThey);

    window[`Player${i}Name`]          = Name;
    window[`Player${i}HeSheThey`]     = pfx.HeSheThey;
    window[`Player${i}HimHerThem`]    = pfx.HimHerThem;
    window[`Player${i}HisHerTheir`]   = pfx.HisHerTheir;
    window[`Player${i}HisHersTheirs`] = pfx.HisHersTheirs;
    window[`Player${i}WasWere`]       = pfx.WasWere;
    window[`Player${i}DoesDo`]        = pfx.DoesDo;
    window[`Player${i}HasHave`]       = pfx.HasHave;
    window[`Player${i}Class`]         = Class;
    window[`Player${i}Weapon`]        = Weapon;
    window[`Player${i}Damage`]        = Damage;

    players.push({Name, HeSheThey, Class, Weapon, Damage});
  }


  // render top summary
  document.getElementById("customDisplay").innerHTML =
    players.map((p, i) =>
      `<strong>Player ${i+1}:</strong> ${p.Name} — <em>${p.HeSheThey}</em> | Class: ${p.Class} | Weapon: ${p.Weapon} | Damage: ${p.Damage}`
    ).join("<br>");

  // story injection
  const storyText = `"This place looks awful," ${Player1Name} murmured.`;
  document.getElementById("storyBox").innerText = storyText;

  function copyStory(){
    navigator.clipboard.writeText(storyText)
      .then(_=>alert("Story copied!"))
      .catch(_=>alert("Copy failed."));
  }

 function renderHPTracker() {
  const partyDiv = document.getElementById("partyRows");
  const enemyDiv = document.getElementById("enemyRows");
  partyDiv.innerHTML = "";
  enemyDiv.innerHTML = "";

players.forEach(p => {
const maxLength = 20;
const displayName = p.Name.length > maxLength
  ? p.Name.slice(0, maxLength) + "…"
  : p.Name;

  const row = document.createElement("div");
  row.className = "hp-entry";

  row.innerHTML = `
    <div class="hp-left">
      <span class="name">${displayName}</span>
    </div>
    <div class="hp-right">
      <input type="number" class="current-hp" value="10" min="0" placeholder="Current">/
      <input type="number" class="max-hp" value="10" min="1" placeholder="Max">
      <label class="dead-toggle">
        <input type="checkbox" title="Dead?">
        ☠
      </label>
    </div>
  `;

  partyDiv.appendChild(row);
});



  // enemy row
  const m = document.createElement("div");
  m.className = "hp-entry";
  m.innerHTML = `
    <div class="hp-left">
      <span class="name">Giant Mud Slime</span>
    </div>


    <div class="hp-right">
      <input type="number" class="current-hp" value="20" min="0" placeholder="Current">/
      <input type="number" class="max-hp" value="20" min="1" placeholder="Max">
      <label class="dead-toggle">
        <input type="checkbox" title="Dead?">
        ☠
      </label>
    </div>
  `;
  enemyDiv.appendChild(m);
}
renderHPTracker();


  // sync titles + nav helpers
  const title = "Your Prompt Title Here";
  document.getElementById("pageTitle").innerText   = title;
  document.getElementById("promptTitle").innerText = title;

  function goToFix()    { window.location.href = `fix.html?${params}`; }
  function goToPage(pg){ window.location.href = `${pg}.html?${params}`; }

const conditionMap = {
  partyVictory: `Against all odds, the party triumphed in glorious fashion.`,
  manDownVictory: `Despite losing a comrade, the party secured a hard-fought victory.`,
  partyKill: `The entire party was overwhelmed. Their quest ends here.`,
  manDownFlee: `The Giant Mud Slime was still a terrifying force... [full narrative here]`,
  partyFlee: `They ran away`,
  fleeBeforeBattle: `They ran away`
};

const contentBox = document.getElementById("narrativeContent");

document.getElementById("conditionButtons").addEventListener("click", e => {
  if (e.target.tagName !== "BUTTON") return;

  const key = e.target.dataset.key;
  const text = conditionMap[key] || "No narrative available.";
  contentBox.textContent = text;
});

document.getElementById("copyNarrative").addEventListener("click", () => {
  const text = contentBox.textContent.trim();
  if (!text) return;

  const btn = document.getElementById("copyNarrative");

  navigator.clipboard.writeText(text)
    .then(() => {
      btn.textContent = "Copied!";
      setTimeout(() => {
        btn.textContent = "Copy Text";
      }, 1500);
    })
    .catch(() => {
      btn.textContent = "Copy failed";
      setTimeout(() => {
        btn.textContent = "Copy Text";
      }, 1500);
    });
});

document.querySelectorAll(".continueButtons button").forEach(btn => {
  btn.addEventListener("click", () => {
    const baseURL = btn.dataset.href;
    const currentParams = window.location.search; // includes the "?" prefix
    const fullURL = baseURL + currentParams;
    window.location.href = fullURL;
  });
});

document.getElementById("openNewTab").addEventListener("click", () => {
  const targetURL = "https://perchance.org/oa-battle-sim-tainted-spring-mud-slime-fight-1"; // replace with your actual link
  const currentParams = window.location.search;
  const fullURL = targetURL + currentParams;

  window.open(fullURL, "_blank");
});



</script>
</body>
</html>
